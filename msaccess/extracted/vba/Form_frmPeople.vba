' Module Name: Form_frmPeople
' Module Type: Document Module
' Lines of Code: 2287
' Extracted: 2026-02-04 13:03:36

Option Compare Database
Option Explicit

Dim InitialLoadAllPeopleRecords As Boolean, MessageSummary As Variant, RecordDeletedCount As Integer
Dim PhysicalAndMailingAddressesAreTheSame As Boolean, PeopleRecordWasDeleted As Boolean, SelectCriteriaLocked As Boolean
Dim LastPersonIndexedName As Variant, FirstPersonIndexedName As Variant, SearchUserName As Variant


' *********************
' * Form Subroutines. *
' *********************

Private Sub Form_Load()
On Error GoTo ShowMeError
    Dim ResultIndexedName As Variant, rst As DAO.Recordset
    DoCmd.SetWarnings False
'   DoCmd.OpenForm "frmPleaseWaitBrief"
    ' Initialize parameters.
    Form_frmMainMenu.NewRecordInProgress = False: Me.FilterOn = False: ShowActiveOnly.Visible = False: ShowActiveOnly = False: ResetPeopleRecordButtons = False
    ' Delete all "null" people from the People table.
    Call ProgressMessages("Open", "Deleted corrupted People records.")
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryDeleteCorruptedPeopleRecords"
    ' Update Staff Supervisors.
    Call ProgressMessages("Append", "Update staff supervisors.")
    DoCmd.OpenQuery "qryUpdateStaffSupervisors"
    ' Check for anomalies and contradictions in the data.
    Call ProgressMessages("Append", "Update LivingWithParentOrGuardian flag if inccorect.")
    DoCmd.OpenQuery "qryRepairAnomalies1"
    DoCmd.OpenQuery "qryRepairAnomalies2"
    DoCmd.OpenQuery "qryRepairAnomalies3"
    DoCmd.OpenQuery "qryRepairAnomalies4"
    ' Count all people.
    Call ProgressMessages("Append", "Count all people.")
    PeopleCount = DCount("IndexedName", "tblPeople")
    PeopleCountLbl = "people and companies (active and inactive)"
    PeopleRecordWasDeleted = False
    PeopleFormClosed = False
    SelectCriteriaLocked = False
    ' Check for limiting filters.
    Call ProgressMessages("Append", "Process limiting filters.")
    Call ProcessLimitingFilters
    ' Check if user requested to add a family member to a client.  Reset if set.
    If AddFamilyMemberToClient Then
        Me.Requery
        AddFamilyMemberToClient = False
        Call BriefDelay
    End If
    ' Find first and last people records.
    Call ProgressMessages("Append", "Identify first and last records to set boundaries.")
    Set rst = Me.RecordsetClone:
    rst.MoveFirst:
    FirstPersonIndexedName = rst!IndexedName
    rst.MoveLast
    LastPersonIndexedName = rst!IndexedName
    Set rst = Nothing
'   DoCmd.Close acForm, "frmPleaseWaitBrief"
    DoCmd.SetWarnings True
    Call ProgressMessages("Close", "Done.")
   Exit Sub

ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub Form_Current()
On Error GoTo ShowMeError
    SysCmdResult = SysCmd(4, "People View"): RememberRecordLastViewedBy = RecordLastViewedBy: RememberRecordLastViewedDate = RecordLastViewedDate: PeopleFormClosed = False
    ' Initialize global flags.
    Me.SetFocus
'   DoCmd.OpenForm "frmPleaseWaitBrief"
    Call ProgressMessages("Open", "Initialize people form parameters.")
    ErrorMessages.BackStyle = 0: ErrorMessages = "": AllServicesInactive.Visible = False: NewClient = False: NumberOfClientServices = 0: InvalidFamilyCountMessageDisplay = False
    SelectPersonByLastName = Null: SelectPersonByFirstName = Null: SelectCompany = Null: SelectPersonByLastName.SetFocus: ManagerSupervisor.Visible = False
    Call DropTempTables
    ' Who Can delete records?
    Button_DeleteRecord.Visible = DCount("Action", "catUserPermissions", "User='" & Form_frmMainMenu.UserName & "' AND Action='Can delete records'") > 0
    ' Close any subforms that were previously open.
    Call CloseAllPeopleForms(False)
    ' Show Salutation field if there is none set for this person.
    If IsNull(MiddleInitial) Or Len(MiddleInitial) = 0 Then _
        If LastName = "!" Then DisplayName = RTrim(FirstName) Else DisplayName = RTrim(Salutation) & " " & RTrim(FirstName) & " " & RTrim(LastName) _
    Else _
        DisplayName = RTrim(Salutation) & " " & RTrim(FirstName) & " " & RTrim(MiddleInitial) & " " & RTrim(LastName)
    DisplayName.Visible = False: FamiliarGreeting.Visible = False: SigningAuthority.Visible = False: ContractStaff.Visible = False: ContractOwner.Visible = False
    ' Set full addresses for comparison purposes.
    BeforeFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
    BeforeFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
    AfterFullMailingAddress = BeforeFullMailingAddress: AfterFullPhysicalAddress = BeforeFullPhysicalAddress
    ' Set labels for normal display.  Make buttons visible.  Unlock the people category fields and make them visible.
    Call SetLabelsNormal: Call MakeButtonsVisible: Call UnlockPeopleFields
    ' Make the filter bars visible.
    If Form_frmMainMenu.StaffOnly Then
        FilterCriteria.Visible = False: FilterClientSubcategory.Visible = False: SelectCompany.Visible = False: ShowPeople.Visible = False: ShowCompaniesOrganizations.Visible = False
    Else
        FilterCriteria.Visible = True: FilterClientSubcategory.Visible = (FilterCriteria = "Clients"): SelectCompany.Visible = True: ShowPeople.Visible = True: ShowCompaniesOrganizations.Visible = True
    End If
    ' Make fields visible.  If there is no name field, make the company field prominent.
    Call UnlockPeopleCategories
    If (Len(FirstName) <= 0 Or IsNull(FirstName)) And (Len(LastName) <= 0 Or IsNull(LastName)) And (Len(MiddleInitial) <= 0 Or IsNull(MiddleInitial)) Then Call SetNameProminence("Company") Else Call SetNameProminence("Person")
    ' Check for addresses in the people record.
    Call CheckForAddresses
    ' Continue initializing.
    If IsDeceased Then Call BlueAndBold(IsDeceasedLabel)
    StaffEmailAddress.Visible = False: EmailAddress.Visible = True
    InterestedPartyCategory.Visible = False: InterestedPartyInactive.Visible = False
    Call YellowAndNormal(IsInterestedPartyLabel)
    ' Process people categories.  A person may be in more than one category.
    Call ProgressMessages("Append", "Identify person's services.")
    If IsDonor Then Call ProcessDonor
    If IsInterestedParty Then Call ProcessInterestedParty
    If IsClient Then Call ProcessClient
    If IsFamilyGuardian Then Call ProcessFamily
    If IsStaff Then Call ProcessStaff
    If IsConsultant Then Call ProcessConsultant
    ' Close locations form if open.  Return the focus to the main people form.  Set filter based on selected category.
    If CurrentProject.AllForms("frmLocations").IsLoaded Then Call CloseForm("frmLocations"): Form_frmPeople.SetFocus: Call ProcessFilterCriteria
    ' Show the error messages blob.
    ErrorMessages.Visible = Not AllServicesInactive.Visible
    ' Set Client Jump filter criteria,
    Select Case ClientJumpFromFamily
        Case 1
            FilterCriteria = "<Show all>": FilterClientSubcategory = Null: FilterClientSubcategory.Visible = False: Call FilterCriteria_AfterUpdate
            ClientJumpFromFamily = 2
            Me.FilterOn = False: Me.Filter = "IsFamilyGuardian = True AND IndexedName = """ & ClientJumpName & """": Me.FilterOn = True: Me.Refresh
        Case 2
            ClientJumpFromFamily = 0
        Case Else
    End Select
    ' No error messages.  Hide the field.
    If IsNull(ErrorMessages) Or Len(ErrorMessages) = 0 Then ErrorMessages.BackStyle = 0 Else ErrorMessages.BackStyle = 1
    ' Set the last view date and user.
    Call SetLastViewedInfo
    Me.SetFocus
'   DoCmd.Close acForm, "frmPleaseWaitBrief"
    DoCmd.SetWarnings True
    Call ProgressMessages("Close", "Done.")
    Exit Sub
ShowMeError:
'   DoCmd.Close acForm, "frmPleaseWaitBrief"
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub Form_BeforeUpdate(Cancel As Integer)
    Dim Subject As String, TextBody As String
    
    If IsClientSpring Then
        If (AfterFullPhysicalAddress <> BeforeFullPhysicalAddress) Then _
            Call SendEmailMessage("tilldbnotifications@tillinc.org", DLookup("ParameterValue", "appParameters", "ID=22"), "db.springboard@tillinc.org", Null, _
            "TILLDB: Springboard Member Physical Address Change", _
            "The physical address for " & FirstName & " " & LastName & " was changed by " & Form_frmMainMenu.UserName & " to " & MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP & ".", Null)
        If (AfterFullMailingAddress <> BeforeFullMailingAddress) Then _
            Call SendEmailMessage("tilldbnotifications@tillinc.org", DLookup("ParameterValue", "appParameters", "ID=22"), "db.springboard@tillinc.org", Null, _
            "TILLDB: Springboard Member Mailing Address Change", _
            "The mailing address for " & FirstName & " " & LastName & " was changed by " & Form_frmMainMenu.UserName & " to " & MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP & ".", Null)
    End If
End Sub

Private Sub ProcessLimitingFilters()
On Error GoTo ShowMeError
    If Form_frmMainMenu.StaffOnly Then
        ' Staff only.  Set the record source to staff only and recount.
        SysCmdResult = SysCmd(4, "Filtering staff only.")
        FilterCriteria = "Staff"
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsStaff=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsStaff=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
        SelectCriteriaLocked = True: FilterCriteria.Visible = False: FilterClientSubcategory.Visible = False
        Me.RecordSource = "SELECT tblPeople.* FROM tblPeople WHERE IsStaff=True ORDER BY IndexedName;"
        PeopleCount = DCount("IndexedName", "tblPeople", "IsStaff=True"): PeopleCountLbl = "staff"
        Me.Requery
    ElseIf Form_frmMainMenu.SpringboardOnly Then
        ' Springboard Only.  Set record source to Springboard clients only.
        SysCmdResult = SysCmd(4, "Filtering Springboard individuals only.")
        FilterCriteria = "": FilterClientSubcategory = "": SelectCriteriaLocked = True
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords LEFT JOIN (tblPeopleFamily LEFT JOIN tblPeople AS tblPeople_1 ON tblPeopleFamily.ClientIndexedName = tblPeople_1.IndexedName) ON qryPeopleAllPeopleRecords.IndexedName = tblPeopleFamily.IndexedName " & _
            "WHERE (qryPeopleAllPeopleRecords.IsFamilyGuardian=True AND tblPeople_1.IsClientSpring=True) OR " & _
                  "(qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.IsClientSpring=True) OR " & _
                  "(qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.IsClientPCA=False AND qryPeopleAllPeopleRecords.IsClientDay=False AND qryPeopleAllPeopleRecords.IsClientRes=False AND qryPeopleAllPeopleRecords.IsClientTrans=False AND qryPeopleAllPeopleRecords.IsClientSHC=False AND qryPeopleAllPeopleRecords.IsClientSharedLiving=False AND qryPeopleAllPeopleRecords.IsCilentCLO=False AND qryPeopleAllPeopleRecords.IsClientIndiv=False AND qryPeopleAllPeopleRecords.IsClientAdultComp=False AND qryPeopleAllPeopleRecords.IsClientAdultCoach=False AND qryPeopleAllPeopleRecords.IsClientNHDay=False AND qryPeopleAllPeopleRecords.IsClientNHRes=False AND qryPeopleAllPeopleRecords.IsClientAutism=False AND qryPeopleAllPeopleRecords.IsClientSpring=False AND qryPeopleAllPeopleRecords.IsClientTRASE=False AND qryPeopleAllPeopleRecords.IsClientCommunityConnections=False AND qryPeopleAllPeopleRecords.IsClientVocat=False) OR " & _
                  "(qryPeopleAllPeopleRecords.IndexedName Not Like '///*' AND qryPeopleAllPeopleRecords.IsFamilyGuardian=False AND qryPeopleAllPeopleRecords.IsClient=False AND qryPeopleAllPeopleRecords.IsDonor=False AND qryPeopleAllPeopleRecords.IsInterestedParty=False AND qryPeopleAllPeopleRecords.IsStaff=False AND qryPeopleAllPeopleRecords.IsConsultant=False) ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords LEFT JOIN (tblPeopleFamily LEFT JOIN tblPeople AS tblPeople_1 ON tblPeopleFamily.ClientIndexedName = tblPeople_1.IndexedName) ON qryPeopleAllPeopleRecords.IndexedName = tblPeopleFamily.IndexedName " & _
            "WHERE (qryPeopleAllPeopleRecords.IsFamilyGuardian=True AND tblPeople_1.IsClientSpring=True) OR " & _
                  "(qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.IsClientSpring=True) OR " & _
                  "(qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.IsClientPCA=False AND qryPeopleAllPeopleRecords.IsClientDay=False AND qryPeopleAllPeopleRecords.IsClientRes=False AND qryPeopleAllPeopleRecords.IsClientTrans=False AND qryPeopleAllPeopleRecords.IsClientSHC=False AND qryPeopleAllPeopleRecords.IsClientSharedLiving=False AND qryPeopleAllPeopleRecords.IsCilentCLO=False AND qryPeopleAllPeopleRecords.IsClientIndiv=False AND qryPeopleAllPeopleRecords.IsClientAdultComp=False AND qryPeopleAllPeopleRecords.IsClientAdultCoach=False AND qryPeopleAllPeopleRecords.IsClientNHDay=False AND qryPeopleAllPeopleRecords.IsClientNHRes=False AND qryPeopleAllPeopleRecords.IsClientAutism=False AND qryPeopleAllPeopleRecords.IsClientSpring=False AND qryPeopleAllPeopleRecords.IsClientTRASE=False AND qryPeopleAllPeopleRecords.IsClientCommunityConnections=False AND qryPeopleAllPeopleRecords.IsClientVocat=False) OR " & _
                  "(qryPeopleAllPeopleRecords.IndexedName Not Like '///*' AND qryPeopleAllPeopleRecords.IsFamilyGuardian=False AND qryPeopleAllPeopleRecords.IsClient=False AND qryPeopleAllPeopleRecords.IsDonor=False AND qryPeopleAllPeopleRecords.IsInterestedParty=False AND qryPeopleAllPeopleRecords.IsStaff=False AND qryPeopleAllPeopleRecords.IsConsultant=False) ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
        FilterCriteria.Visible = False: FilterClientSubcategory.Visible = False
        Me.RecordSource = "SELECT tblPeople.* FROM (tblPeople LEFT JOIN tblPeopleFamily ON tblPeople.IndexedName = tblPeopleFamily.IndexedName) " & _
            "LEFT JOIN tblPeople AS tblPeople_1 ON tblPeopleFamily.ClientIndexedName = tblPeople_1.IndexedName " & _
            "WHERE (tblPeople.IsFamilyGuardian=True AND tblPeople_1.IsClientSpring=True) OR " & _
                  "(tblPeople.IsClient=True AND tblPeople.IsClientSpring=True) OR " & _
                  "(tblPeople.IsClient=True AND tblPeople.IsClientPCA=False AND tblPeople.IsClientDay=False AND tblPeople.IsClientRes=False AND tblPeople.IsClientTrans=False AND tblPeople.IsClientSHC=False AND tblPeople.IsClientSharedLiving=False AND tblPeople.IsCilentCLO=False AND tblPeople.IsClientIndiv=False AND tblPeople.IsClientAdultComp=False AND tblPeople.IsClientAdultCoach=False AND tblPeople.IsClientNHDay=False AND tblPeople.IsClientNHRes=False AND tblPeople.IsClientAutism=False AND tblPeople.IsClientSpring=False AND tblPeople.IsClientTRASE=False AND tblPeople.IsClientCommunityConnections=False AND tblPeople.IsClientVocat=False) OR " & _
                  "(tblPeople.IndexedName Not Like '///*' AND tblPeople.IsFamilyGuardian=False AND tblPeople.IsClient=False AND tblPeople.IsDonor=False AND tblPeople.IsInterestedParty=False AND tblPeople.IsStaff=False AND tblPeople.IsConsultant=False) ORDER BY tblPeople.IndexedName;"
        PeopleCount = ActiveClientCount("SPRINGBOARD"): PeopleCountLbl = "Springboard individuals": Me.Requery
    Else
        ' Show everyone.
        SysCmdResult = SysCmd(4, "Filtering all people.")
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords ORDER BY IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords ORDER BY FirstName, LastName;"
        SelectCriteriaLocked = False: Me.RecordSource = "SELECT tblPeople.* FROM tblPeople ORDER BY IndexedName;": Me.Requery
    End If
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub CheckForAddresses()
    ' Initialize address backcolors.
    Call SetPhysicalAddressColor("White"): Call SetMailingAddressColor("White")
    SysCmdResult = SysCmd(4, "Checking addresses.")
    ' Check to see if there are addresses.
    If Not IsStaff Then
        If Not IsDeceased And (Len(PhysicalAddress) = 0 Or IsNull(PhysicalAddress)) And (Len(MailingAddress) = 0 Or IsNull(MailingAddress)) Then ' No addresses.
            ErrorMessages = ErrorMessages & "[Sev Med] This individual has no physical or mailing address.  Please provide." & vbCrLf & " " & vbCrLf
            ErrorMessages.BackStyle = 1
        End If
        If Not (Len(PhysicalAddress) = 0 Or IsNull(PhysicalAddress)) Then ' If there's a physical address but no mailing address, set mailing address to physical address.
            If (Len(MailingAddress) = 0 Or IsNull(MailingAddress)) Then
                MailingAddress = PhysicalAddress: MailingCity = PhysicalCity: MailingState = PhysicalState: MailingZIP = PhysicalZIP: MailingAddressValidated = False
            End If
        End If
        If (Len(PhysicalAddress) = 0 Or IsNull(PhysicalAddress)) Then ' If there's a mailing address but no physical address, set physical address to mailing address.
            If Not (Len(MailingAddress) = 0 Or IsNull(MailingAddress)) Then
                PhysicalAddress = MailingAddress: PhysicalCity = MailingCity: PhysicalState = MailingState: PhysicalZIP = MailingZIP: PhysicalAddressValidated = False
            End If
        End If
    End If
    ' Determine if physical and mailing addresses are the same.
    If PhysicalAddress = MailingAddress Or ((Len(PhysicalAddress) = 0 Or IsNull(PhysicalAddress)) And (Len(MailingAddress) = 0 Or IsNull(MailingAddress))) Then PhysicalAndMailingAddressesAreTheSame = True Else PhysicalAndMailingAddressesAreTheSame = False
    ' If there's a 10-digit ZIP, the physical address is assumed valid.
    If Not PhysicalAddressValidated Then
        If Len(PhysicalZIP) = 10 Then
            PhysicalAddressValidated = True: Call SetPhysicalAddressColor("White")
        ElseIf (Len(PhysicalAddress) = 0 Or IsNull(PhysicalAddress)) And (Len(PhysicalCity) = 0 Or IsNull(PhysicalCity)) And (Len(PhysicalState) = 0 Or IsNull(PhysicalState)) Then
            PhysicalAddressValidated = False: Call SetPhysicalAddressColor("Red")
        Else
            Call ValidatePhysicalAddress
        End If
    End If
    ' Run the mailing address validation test.
    If Not MailingAddressValidated Then
        If PhysicalAndMailingAddressesAreTheSame Then ' Mailing address is same as physical address so flag it as validated.
            If PhysicalAddressValidated Then ' Physical address is valid.
                If MailingAddressValidated Then Call SetMailingAddressColor("White") Else Call SetMailingAddressColor("Green")
                MailingAddressValidated = True
                MailingAddress = PhysicalAddress: Call UpdateChangeLog("MailingAddress-AutoSet", MailingAddress):
                MailingCity = PhysicalCity: Call UpdateChangeLog("MailingCity-AutoSet", MailingCity)
                MailingState = PhysicalState: Call UpdateChangeLog("MailingState-AutoSet", MailingState)
                MailingZIP = PhysicalZIP: Call UpdateChangeLog("MailingZIP-AutoSet", MailingZIP)
                Exit Sub
            Else
                MailingAddressValidated = False
                MailingAddress = PhysicalAddress: MailingCity = PhysicalCity: MailingState = PhysicalState: MailingZIP = PhysicalZIP
                Call SetMailingAddressColor("Red")
            End If
        End If
        ' If there's a 10-digit ZIP, the mailing address is assumed valid.
        If Len(MailingZIP) = 10 Then
            MailingAddressValidated = True:  Call SetMailingAddressColor("White")
        ElseIf (Len(MailingAddress) = 0 Or IsNull(MailingAddress)) And (Len(MailingCity) = 0 Or IsNull(MailingCity)) And (Len(MailingState) = 0 Or IsNull(MailingState)) Then
            MailingAddressValidated = False: Call SetMailingAddressColor("Red")
        Else
            Call ValidateMailingAddress
        End If
    End If
    SysCmdResult = SysCmd(4, "People View")
End Sub

' ******************************************************************************
' * After address update processing.  Things to do when an address is changed. *
' ******************************************************************************

Private Sub MailingAddress_AfterUpdate()
    If UCase(Left(MailingAddress, 6)) = "PO BOX" Then MailingAddress = StrConv(MailingAddress, vbUpperCase) Else MailingAddress = CorrectProperNames(StrConv(MailingAddress, vbProperCase))
    MailingAddressValidated = False: MailingZIP = ""
    Call UpdateChangeLog("MailingAddress", MailingAddress)
    AfterFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
End Sub

Private Sub MailingCity_AfterUpdate()
    MailingCity = CorrectProperNames(StrConv(MailingCity, vbProperCase))
    MailingAddressValidated = False: MailingZIP = ""
    Call UpdateChangeLog("MailingCity", MailingCity)
    AfterFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
End Sub

Private Sub MailingState_AfterUpdate()
    MailingAddressValidated = False: MailingZIP = ""
    Call UpdateChangeLog("MailingState", MailingState)
    AfterFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
End Sub

Private Sub MailingZIP_AfterUpdate()
    MailingAddressValidated = False
    Call UpdateChangeLog("MailingZIP", MailingZIP)
    AfterFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
End Sub

Private Sub PhysicalAddress_AfterUpdate()
    If UCase(Left(PhysicalAddress, 6)) = "PO BOX" Then PhysicalAddress = StrConv(PhysicalAddress, vbUpperCase) Else PhysicalAddress = CorrectProperNames(StrConv(PhysicalAddress, vbProperCase))
    ' Set mailing address same as the physical address if there's currently no mailing address.
    If IsNull(MailingAddress) Then
        MailingAddress = PhysicalAddress: MailingZIP = "": MailingAddressValidated = False
        Call UpdateChangeLog("MailingAddress-AutoSet", MailingAddress)
    End If
    PhysicalAddressValidated = False: PhysicalZIP = ""
    Call UpdateChangeLog("PhysicalAddress", PhysicalAddress)
    Call UpdateCounty
    AfterFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
End Sub

Private Sub PhysicalCity_AfterUpdate()
    PhysicalCity = StrConv(PhysicalCity, vbProperCase)
    ' Set mailing city same as the physical city if there's currently no mailing address.
    If IsNull(MailingCity) Then
        MailingCity = PhysicalCity: MailingAddressValidated = False: MailingZIP = ""
        Call UpdateChangeLog("MailingCity-AutoSet", MailingCity)
    End If
    PhysicalAddressValidated = False: PhysicalZIP = ""
    Call UpdateChangeLog("PhysicalCity", PhysicalCity)
    Call UpdateCounty
    AfterFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
End Sub

Private Sub PhysicalState_AfterUpdate()
    ' Set mailing state same as the physical state if there's currently no mailing address.
    If IsNull(MailingState) Then
        MailingState = PhysicalState: MailingAddressValidated = False: MailingZIP = ""
        Call UpdateChangeLog("MailingState-AutoSet", MailingState)
    End If
    PhysicalAddressValidated = False: PhysicalZIP = ""
    Call UpdateChangeLog("PhysicalState", PhysicalState)
    Call UpdateCounty
    AfterFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
End Sub

Private Sub PhysicalZIP_AfterUpdate()
    ' Set mailing ZIP same as the physical ZIP if there's currently no mailing address.
    If IsNull(MailingZIP) Then
        MailingZIP = PhysicalZIP: MailingAddressValidated = False
        Call UpdateChangeLog("MailingZIP-AutoSet", MailingZIP)
    End If
    PhysicalAddressValidated = False
    Call UpdateChangeLog("PhysicalZIP", PhysicalZIP)
    Call UpdateCounty
    AfterFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
End Sub

Private Sub ShowActiveOnly_Click()
    Me.FilterOn = False
    If ShowActiveOnly Then
        If SelectCriteriaLocked Then Exit Sub
        Me.Filter = "isClient = True AND ClientCompletelyInactive = False"
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.ClientCompletelyInactive = False ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.ClientCompletelyInactive = False ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
        FilterClientSubcategory.Visible = False
    Else
        Me.Filter = "isClient = True"
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
        FilterClientSubcategory.Visible = True
    End If
    Me.FilterOn = True: Me.AllowAdditions = False: Me.AllowDeletions = False
    Button_NewRecord.Visible = False: Button_DeleteRecord.Visible = False
    PeopleCount = DCount("IndexedName", "tblPeople", Me.Filter): PeopleCountLbl = "people"
End Sub

Private Sub StaffPositionIsOpen_Click()
    If StaffPositionIsOpen Then
        FirstName = "TBD": LastName = Mid(StaffLocation, InStr(1, StaffLocation, "-", vbTextCompare) + 1, 255)
        If IsNull(MiddleInitial) Or Len(MiddleInitial) = 0 Then IndexedName = LastName & "/" & FirstName & "//" Else IndexedName = LastName & "/" & FirstName & "/" & MiddleInitial & "/"
        FamiliarGreeting = "Greetings"
        Call ProcessOpenStaffPosition
        Call BriefDelay
    End If
End Sub

' **************************************************
' * After update processing for other form fields. *
' **************************************************

Private Sub DID_AfterUpdate()
    If IsNull(DID) Then Exit Sub
    If DCount("IndexedName", "tblPeople", "DID=" & DID) > 1 Then ' Someone else has this DID.
        MsgBox "DID " & DID & " is also currently assigned to " & _
            DLookup("FirstName", "tblPeople", "IndexedName=""" & DLookup("IndexedName", "tblPeople", "DID=" & DID & " AND IndexedName<>""" & IndexedName & """") & """") & _
            ".  Please correct this.", vbOKOnly, "Warning"
        Exit Sub
    End If
    Call UpdateChangeLog("Staff DID", [DID])
End Sub

Private Sub GPSuperCode_AfterUpdate()
    GPSuperCode = StrConv(GPSuperCode, vbUpperCase)
    Call UpdateChangeLog("GPSuperCode", GPSuperCode)
End Sub

Private Sub DeceasedDate_AfterUpdate()
    If Not ValidDate(DeceasedDate) Then
        DeceasedDate = Null: DeceasedDate.SetFocus
    Else
        Call UpdateChangeLog("Deceased Date", Format(DeceasedDate, "mm/dd/yyyy")): MailingAddress.SetFocus
    End If
End Sub

Private Sub OfficeCityTown_AfterUpdate()
    CityPicker = OfficeCityTown: Call UpdateChangeLog("OfficeCityTown", OfficeCityTown): OfficeLocationName.Requery
End Sub

Private Sub StaffTitle_AfterUpdate()
    StaffTitle = CorrectProperNames(StrConv(StaffTitle, vbProperCase)): Call UpdateChangeLog("StaffTitle", StaffTitle)
End Sub

Private Sub EmailAddress_AfterUpdate()
    If Not IsDeceased And InStr(1, EmailAddress, " ", vbTextCompare) > 0 Then
        EmailAddress = ""
        ErrorMessages = ErrorMessages & "[Sev Med]   Email Address contains a space which is not valid." & vbCrLf & " " & vbCrLf
        ErrorMessages.BackStyle = 1
    ElseIf Not IsDeceased And InStr(1, EmailAddress, "@", vbTextCompare) = 0 Then
        EmailAddress = ""
        ErrorMessages = ErrorMessages & "[Sev Med]   Email Address does not contain '@'." & vbCrLf & " " & vbCrLf
        ErrorMessages.BackStyle = 1
    Else
        Call UpdateChangeLog("EmailAddress", EmailAddress)
    End If
End Sub

' ******************
' * Filter fields. *
' ******************

Private Sub ProcessFilterCriteria()
    ' Set filters based on the selected criteria.
    If SelectCriteriaLocked Then Exit Sub
    Select Case FilterCriteria
        Case "Clients"
            If ShowActiveOnly Then
            ElseIf Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Family/Guardians"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsFamilyGuardian=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsFamilyGuardian=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Donors"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsDonor=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsDonor=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Interested Parties"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsInterestedParty=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsInterestedParty=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Staff"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsStaff=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsStaff=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Consultants"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsConsultant=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsConsultant=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Completely Inactive"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.ClientCompletelyInactive=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsClient=True AND qryPeopleAllPeopleRecords.ClientCompletelyInactive=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case "Deceased"
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsDeceased=True ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords WHERE qryPeopleAllPeopleRecords.IsDeceased=True ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
        Case Else
            If Not SelectCriteriaLocked Then
                SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords ORDER BY qryPeopleAllPeopleRecords.IndexedName;"
                SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords ORDER BY qryPeopleAllPeopleRecords.FirstName, qryPeopleAllPeopleRecords.LastName;"
            End If
    End Select
    SelectPersonByLastName = Null: SelectPersonByFirstName = Null: SelectCompany = Null: SelectPersonByLastName.SetFocus
End Sub

Private Sub SelectCompany_AfterUpdate()
On Error GoTo ShowMeError
    Dim ResultIndexedName As Variant, rst As DAO.Recordset

    DoCmd.SetWarnings False
    If IsNull(SelectCompany) Or Len(SelectCompany) <= 0 Then Exit Sub
    Set rst = Me.RecordsetClone: Call DropTempTables
    DoCmd.OpenQuery "qryCreateTempCompaniesLookup"
'    TILLDataBase.Execute "SELECT DISTINCT tblPeople.CompanyOrganization, tblPeople.IndexedName, Len([CompanyOrganization]) AS Crit " & _
'        "INTO temptbl0 FROM tblPeople WHERE (((Len([CompanyOrganization])) > 0)) ORDER BY tblPeople.CompanyOrganization;", dbseechanges: call briefdelay
    ResultIndexedName = DLookup("IndexedName", "temptbl0", "CompanyOrganization = """ & SelectCompany & """ AND Left(IndexedName,3)= '///'")
    If IsNull(ResultIndexedName) Then
        MsgBox "No such company", vbOK, "Error": SelectCompany = ""
        Exit Sub
    End If
    rst.FindFirst "IndexedName = """ & ResultIndexedName & """": Me.Bookmark = rst.Bookmark: Call DropTempTables: Me.SetFocus: SelectPersonByLastName.SetFocus
    DoCmd.SetWarnings True
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Function SelectPersonByName(WhichName As Integer) As Boolean
On Error GoTo ShowMeError
    Dim ResultIndexedName As Variant, rst As DAO.Recordset

    SelectPersonByName = True: Set rst = Me.RecordsetClone
    Select Case WhichName
        Case 1
            If IsNull(SelectPersonByLastName) Or Len(SelectPersonByLastName) <= 0 Then
                SelectPersonByName = False: Exit Function
            Else
                ResultIndexedName = DLookup("IndexedName", "qryPeopleAllPeopleRecords", "Person = """ & SelectPersonByLastName & """")
            End If
        Case 2
            If IsNull(SelectPersonByFirstName) Or Len(SelectPersonByFirstName) <= 0 Then
                SelectPersonByName = False: Exit Function
            Else
                ResultIndexedName = DLookup("IndexedName", "qryPeopleAllPeopleRecords", "PersonByFirstName = """ & SelectPersonByFirstName & """")
            End If
    End Select
    If IsNull(ResultIndexedName) Then
        MsgBox "This person is not in the database.", vbOK, "Error": WhichName = "": SelectPersonByName = False: Exit Function
    End If
    rst.FindFirst "IndexedName = """ & ResultIndexedName & """": Me.Bookmark = rst.Bookmark: Me.SetFocus: SelectPersonByLastName.SetFocus
    Exit Function
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Function

Private Sub FilterClientSubcategory_AfterUpdate()
On Error GoTo ShowMeError
    Dim ActiveClients As Long
    
    Me.FilterOn = False
    ' Set filters based on the client subcategory criteria.
    With Form_frmPeople
        Select Case FilterClientSubcategory
            Case "Creative Living Options"
                Me.Filter = "isClient = True and IsCilentCLO = True":                  ActiveClients = ActiveClientCount("Creative Living Options")
                PeopleCountLbl = "CLO individuals (" & ActiveClients & " active)"
            Case "Day Programs"
                Me.Filter = "isClient = True and IsClientDay = True":                  ActiveClients = ActiveClientCount("Day Programs")
                PeopleCountLbl = "Day Services individuals (" & ActiveClients & " active)"
            Case "Individual Support Services"
                Me.Filter = "isClient = True and IsClientIndiv = True":                ActiveClients = ActiveClientCount("Individual Support Services")
                PeopleCountLbl = "ISS individuals (" & ActiveClients & " active)"
            Case "Adult Companion"
                Me.Filter = "isClient = True and IsClientAdultComp = True":            ActiveClients = ActiveClientCount("Adult Companion")
                PeopleCountLbl = "Adult Companion individuals (" & ActiveClients & " active)"
            Case "Adult Coaching"
                Me.Filter = "isClient = True and IsClientAdultCoach = True":           ActiveClients = ActiveClientCount("Adult Coaching")
                PeopleCountLbl = "Adult Coaching individuals (" & ActiveClients & " active)"
            Case "NH Day"
                Me.Filter = "isClient = True and IsClientNHDay = True":                ActiveClients = ActiveClientCount("NH Day")
                PeopleCountLbl = "NH Day individuals (" & ActiveClients & " active)"
            Case "NH Res"
                Me.Filter = "isClient = True and IsClientNHRes = True":                ActiveClients = ActiveClientCount("NH Res")
                PeopleCountLbl = "NH Residential individuals (" & ActiveClients & " active)"
            Case "Residential Services"
                Me.Filter = "isClient = True and IsClientRes = True":                  ActiveClients = ActiveClientCount("Residential Services")
                PeopleCountLbl = "Residential individuals (" & ActiveClients & " active)"
            Case "Shared Living"
                Me.Filter = "isClient = True and IsClientSharedLiving = True":         ActiveClients = ActiveClientCount("Shared Living")
                PeopleCountLbl = "Shared Living individuals (" & ActiveClients & " active)"
            Case "Springboard"
                Me.Filter = "isClient = True and IsClientSpring = True":               ActiveClients = ActiveClientCount("SPRINGBOARD")
                PeopleCountLbl = "Springboard Members (" & ActiveClients & " active)"
            Case "Vocational Services"
                Me.Filter = "isClient = True and IsClientVocat = True":                ActiveClients = ActiveClientCount("Vocational Services")
                PeopleCountLbl = "Vocational individuals (" & ActiveClients & " active)"
            Case Else
                Me.Filter = "isClient = True": PeopleCountLbl = "individuals"
                If ShowActiveOnly Then
                    Me.Filter = Me.Filter & " and ClientCompletelyInactive = False": PeopleCountLbl = "active individuals"
                End If
        End Select
        Me.FilterOn = True: Me.AllowAdditions = False: Me.AllowDeletions = False: Button_NewRecord.Visible = False: Button_DeleteRecord.Visible = False
        PeopleCount = DCount("IndexedName", "tblPeople", Me.Filter): Me.SetFocus
    End With
    Exit Sub

ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub FilterCriteria_AfterUpdate()
On Error GoTo ShowMeError
    Dim rst As DAO.Recordset
    
    Me.FilterOn = False
    ShowActiveOnly.Visible = False
    With Form_frmPeople
        Select Case FilterCriteria
            Case "Clients"
                ShowActiveOnly.Visible = True
                If Not ShowActiveOnly Then
                    Me.Filter = "isClient = True"
                    FilterClientSubcategory.Visible = True
                End If
                PeopleCountLbl = "individuals"
            Case "Family/Guardians":    Me.Filter = "isFamilyGuardian = True":                             PeopleCountLbl = "family/guardians"
            Case "Donors":              Me.Filter = "isDonor = True":                                      PeopleCountLbl = "donors"
            Case "Interested Parties":  Me.Filter = "isInterestedParty = True":                            PeopleCountLbl = "interested parties"
            Case "Staff"
                Me.Filter = "isStaff = True AND LastName <> ""!"""
                PeopleCountLbl = "staff"
            Case "Consultants":         Me.Filter = "isConsultant = True":                                 PeopleCountLbl = "consultants"
            Case "Completely Inactive": Me.Filter = "isClient = True AND ClientCompletelyInactive = True": PeopleCountLbl = "individuals completely inactive"
            Case "Deceased":            Me.Filter = "isDeceased = True":                                   PeopleCountLbl = "deceased individuals"
            Case "Bad Addresses"
                Me.Filter = "isDeceased = False AND ((isInterestedParty = True AND MailingAddressValidated = False) OR (isInterestedParty = False AND isStaff = false and isConsultant = false AND (PhysicalAddressValidated = False or MailingAddressValidated = False) and (not (IsNull(PhysicalAddress) and IsNull(MailingAddress)))))"
                PeopleCountLbl = "people records with bad addresses"
            Case "Missing Addresses"
                Me.Filter = "isDeceased = False AND ((IsNull(PhysicalAddress) and IsNull(MailingAddress)) and isStaff = False and isConsultant = False)"
                PeopleCountLbl = "people records with missing addresses"
            Case Else
                Me.FilterOn = False: Me.AllowAdditions = True: Me.AllowDeletions = True
                ' Who Can delete records?
                Button_DeleteRecord.Visible = DCount("Action", "catUserPermissions", "User='" & Form_frmMainMenu.UserName & "' AND Action='Can delete records'") > 0
                Exit Sub
        End Select
        Me.FilterOn = True: Me.AllowAdditions = False: Me.AllowDeletions = False: Button_NewRecord.Visible = False: Button_DeleteRecord.Visible = False
        PeopleCount = DCount("IndexedName", "tblPeople", Me.Filter): Me.SetFocus
    End With
    Exit Sub
ShowMeError:
        MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Function ShowPeopleClicked() As Boolean
On Error GoTo ShowMeError
    ShowPeopleClicked = True: PeopleCountLbl = "people and companies"
    ' Show everything.
    If ShowPeople And ShowCompaniesOrganizations Then
        If Me.FilterOn Then PeopleCount = DCount("IndexedName", "tblPeople", Me.Filter) Else PeopleCount = DCount("IndexedName", "tblPeople")
        Me.RecordSource = "tblPeople"
    End If
    ' Show people only.
    If ShowPeople And Not ShowCompaniesOrganizations Then
        CurrentRecordSource = "[IndexedName] Not Like '///*'"
        If Me.FilterOn Then PeopleCount = DCount("[IndexedName]", "tblPeople", Me.Filter & " AND [IndexedName] Not Like '///*'") Else PeopleCount = DCount("[IndexedName]", "tblPeople", "[IndexedName] Not Like '///*'")
        PeopleCountLbl = "people"
        Me.RecordSource = "SELECT tblPeople.* FROM tblPeople WHERE tblPeople.IndexedName Not Like '///*' ORDER BY tblPeople.IndexedName;"
    End If
    ' Show companies only.
    If Not ShowPeople And ShowCompaniesOrganizations Then
        CurrentRecordSource = "[IndexedName] Like '///*'"
        If Me.FilterOn Then PeopleCount = DCount("[IndexedName]", "tblPeople", Me.Filter & " AND [IndexedName] Like '///*'") Else PeopleCount = DCount("[IndexedName]", "tblPeople", "[IndexedName] Like '///*'")
        PeopleCountLbl = "companies"
        Me.RecordSource = "SELECT tblPeople.* FROM tblPeople WHERE tblPeople.IndexedName Like '///*' ORDER BY tblPeople.IndexedName;"
    End If
    ' Bad combination.
    If Not ShowPeople And Not ShowCompaniesOrganizations Then
        MsgBox "This is an invalid combination. You must 'show' something.", vbOKOnly, "Selection Error"
        ShowPeople = True
        ShowCompaniesOrganizations = True
        Me.RecordSource = "tblPeople"
        If Me.FilterOn Then PeopleCount = DCount("[IndexedName]", "tblPeople", Me.Filter) Else PeopleCount = DCount("[IndexedName]", "tblPeople")
    End If
    FilterCriteria = "<Show all>": Me.OrderBy = "IndexedName": DoCmd.Requery: PeopleCount.Requery
    Exit Function

ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Function

' *****************************************
' * Show fields based on Person category. *
' *****************************************

Private Sub ProcessPersonCategory(WhoIsIt As Boolean, AppendQuery As String, DetailForm As String)
On Error GoTo ShowMeError
    DoCmd.SetWarnings False
    If WhoIsIt Then
        ' This section displays or hides fields in the form, based on the person category.
        Select Case AppendQuery
            Case "Staff"
                ' Hide everything not staff-related.
                PhysicalAddress.Visible = False: PhysicalAddressValidated = True: PhysicalCity.Visible = False: PhysicalState.Visible = False: PhysicalZIP.Visible = False
                MailingAddress.Visible = False:  MailingAddressValidated = True:  MailingCity.Visible = False:  MailingState.Visible = False:  MailingZIP.Visible = False
                HomePhone.Visible = False: WorkPhone.Visible = False: MobilePhone.Visible = False
                ' Show staff-specific fields.
                OfficeCityTown.Visible = True: OfficeLocationName.Visible = True: StaffTitle.Visible = True: Department.Visible = True: StaffExtPhone.Visible = True
                If Department = "Residential Services" And (StaffTitle = "Residence Manager" Or StaffTitle = "Site Coordinator") Then DID.Visible = False Else DID.Visible = True
                If IsNull(GPSuperCode) Or Len(GPSuperCode) = 0 Then GPSuperCode.Visible = False Else GPSuperCode.Visible = True
                HasPhoneOnDesktop.Visible = DID.Visible
            Case "Interested"
                InterestedPartyCategory.Visible = True: InterestedPartyInactive.Visible = True
            Case "Family"
                frmPeopleFamily.Visible = True: frmPeopleFamily.Requery
            Case "Client"
                ' Fill the demographics table record.
                If DetailForm = "frmPeopleClientsDemographics" Then ' DoCmd.OpenQuery "qryLoadFormDemographics"
                    TILLDataBase.Execute "INSERT INTO tblPeopleClientsDemographics (IndexedName, RecordAddedDate, RecordAddedBy) " & _
                        "SELECT """ & Left(Form_frmPeople.IndexedName, 160) & """ AS IndexedName, " & _
                        "Now () AS RecordAddedDate, """ & Form_frmMainMenu.UserName & """ AS RecordAddedBy;", dbSeeChanges: Call BriefDelay
                    Call BriefDelay
                End If
                ' Fill the vendors table record.
                If DetailForm = "frmPeopleClientsVendors" Then ' DoCmd.OpenQuery "qryLoadFormVendors"
                    TILLDataBase.Execute "INSERT INTO tblPeopleClientsVendors (IndexedName, RecordAddedDate, RecordAddedBy, LivingWithParentOrGuardian, LivingIndependently) " & _
                        "SELECT """ & Left(Form_frmPeople.IndexedName, 160) & """ AS IndexedName, " & _
                        "Now () AS RecordAddedDate, """ & Form_frmMainMenu.UserName & """ AS RecordAddedBy, " & _
                        "False AS LivingWithParentOrGuardian, False AS LivingIndependently;", dbSeeChanges: Call BriefDelay
                    Call BriefDelay
                End If
                ' Open the form.
                DoCmd.OpenForm DetailForm, , , "IndexedName=""" & IndexedName & """"
            Case "Donor"
                DoCmd.OpenForm DetailForm, , , "IndexedName=""" & IndexedName & """"
            Case "Consultant"
                ' Fill the consultants table record.
'               DoCmd.OpenQuery "qryLoadConsultantsTable"
                TILLDataBase.Execute "INSERT INTO tblPeopleConsultants (IndexedName, RecordAddedDate, RecordAddedBy) " & _
                    "SELECT """ & Left(Form_frmPeople.IndexedName, 160) & """ AS IndexedName, " & _
                    "Now () AS RecordAddedDate, """ & Form_frmMainMenu.UserName & """ AS RecordAddedBy;", dbSeeChanges: Call BriefDelay
                ' Open the Consultants form.
                DoCmd.OpenForm DetailForm, , , "IndexedName=""" & IndexedName & """"
            Case Else
                DoCmd.OpenQuery AppendQuery
                DoCmd.OpenForm DetailForm, , , "IndexedName=""" & IndexedName & """"
        End Select
        DoCmd.SetWarnings True
    End If
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

' **********************
' * Button processing. *
' **********************

Private Sub Button_ChangeName_Click()
    DoCmd.OpenForm "frmPeopleChangeName"
    If IsStaff And FirstName = "TBD" Then Call ProcessOpenStaffPosition Else StaffPositionIsOpen = False
    SelectPersonByLastName.SetFocus
End Sub

Private Function CountDeletableRecords(TableName As Variant, Service As Variant) As Boolean
    ' Count records before deleting them.
    SysCmdResult = SysCmd(4, "Counting deletable " & Service & " records.")
    CountDeletableRecords = False
    Select Case Service
        Case "Family": RecordDeletedCount = DCount("IndexedName", "tblPeopleFamily", "ClientIndexedName ='" & IndexedName & "'")
        Case Else:     RecordDeletedCount = DCount("IndexedName", TableName, "IndexedName ='" & IndexedName & "'")
    End Select
    If RecordDeletedCount > 0 Then
        MessageSummary = MessageSummary & "Deleting " & RecordDeletedCount & " " & Service & " records." & vbCrLf
        CountDeletableRecords = True
    End If
End Function

Private Sub Button_DeleteRecord_Click()
On Error GoTo ShowMeError
    Form_frmMainMenu.RememberIndexedName = IndexedName
    If IndexedName = "///Anonymous or Unknown" Then
        MsgBox "The Anonymous or Unknown record cannot be deleted.", vbOKOnly, "ERROR!"
        Exit Sub
    End If
    If MsgBox("Do you really want to delete the entry for " & FirstName & " " & MiddleInitial & " " & LastName & "(" & IndexedName & ")?  This action will delete the People record and all other supporting records in all other tables.", vbYesNo, "Confirm Deletion") = vbYes Then
        DoCmd.SetWarnings False
        DoCmd.OpenForm "frmPleaseWaitBrief"
        Me.AllowDeletions = True
        MessageSummary = ""
        If IsClient Then
            Call CloseClientServicesSubForms
            If CurrentProject.AllForms("frmPeopleClientsVendors").IsLoaded Then Call CloseForm("frmPeopleClientsVendors")
            If CurrentProject.AllForms("frmPeopleClientsDemographics").IsLoaded Then Call CloseForm("frmPeopleClientsDemographics")
            Call CountClientDeletableRecords
            MessageSummary = MessageSummary & vbCrLf & "Proceed?"
            If MsgBox(MessageSummary, vbYesNo, "Summary") = vbYes Then Call CopyAndDeleteAllClientData
        End If
        If IsFamilyGuardian Then
            If CountDeletableRecords("tblPeopleFamily", "Family Records") Then
                MessageSummary = MessageSummary & vbCrLf & "Proceed?"
                If MsgBox(MessageSummary, vbYesNo, "Summary") = vbYes Then Call CopyAndDeleteFamilyRecord
            End If
        End If
        If IsDonor Then
            If CountDeletableRecords("tblPeopleDonors", "Donor") Then
                If CurrentProject.AllForms("frmPeopleDonors").IsLoaded Then Call CloseForm("frmPeopleDonors")
                MessageSummary = MessageSummary & vbCrLf & "Proceed?"
                If MsgBox(MessageSummary, vbYesNo, "Summary") = vbYes Then Call CopyAndDeleteDonorRecord
            End If
        End If
        If IsConsultant Then
            If CountDeletableRecords("tblPeopleConsultants", "Consultant") Then
                If CurrentProject.AllForms("frmPeopleConsultants").IsLoaded Then Call CloseForm("frmPeopleConsultants")
                MessageSummary = MessageSummary & vbCrLf & "Proceed?"
                If MsgBox(MessageSummary, vbYesNo, "Summary") = vbYes Then Call CopyAndDeleteConsultantRecord
            End If
        End If
        ' Copy the main people record to the Deleted table in case we need to recover it.
        DoCmd.GoToRecord , , acFirst
        Call CopyAndDeletePeopleRecord(Form_frmMainMenu.RememberIndexedName)
        ' Done.
        PeopleRecordWasDeleted = True
'       PeopleCount = DCount("IndexedName", "tblPeople", CurrentRecordSource)
        PeopleCount = DCount("IndexedName", "tblPeople")
        Me.AllowDeletions = False
        Me.Requery: Me.Refresh
    End If
    If Me.FilterOn Then Me.FilterOn = False
    Me.SetFocus
    DoCmd.Close acForm, "frmPleaseWaitBrief"
    DoCmd.SetWarnings True

    Exit Sub
ShowMeError:
    DoCmd.Close acForm, "frmPleaseWaitBrief"
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub CountClientDeletableRecords()
    SysCmdResult = SysCmd(4, "Counting deletable records.")
    Call CountDeletableRecords("tblPeopleFamily", "Family")
    Call CountDeletableRecords("tblPeopleClientsAutismServices", "Autism Services")
    Call CountDeletableRecords("tblPeopleClientsCLOServices", "CLO Services")
    Call CountDeletableRecords("tblPeopleClientsCommunityConnectionsServices", "Community Connections")
    Call CountDeletableRecords("tblPeopleClientsDayServices", "Day Services")
    Call CountDeletableRecords("tblPeopleClientsIndividualSupportServices", "Individual Support Services")
    Call CountDeletableRecords("tblPeopleClientsAdultCompanion", "Adult Companion")
    Call CountDeletableRecords("tblPeopleClientsAdultCoaching", "Adult Coaching")
    Call CountDeletableRecords("tblPeopleClientsPCAServices", "PCA Services")
    Call CountDeletableRecords("tblPeopleClientsPCAServicesContactNotes", "PCA Services Contact Notes")
    Call CountDeletableRecords("tblPeopleClientsResidentialServices", "Residential Services")
    Call CountDeletableRecords("tblPeopleClientsSharedLivingServices", "Shared Living")
    Call CountDeletableRecords("tblPeopleClientsNHRes", "NH Residential Services")
    Call CountDeletableRecords("tblPeopleClientsNHDay", "NH Day Services")
    Call CountDeletableRecords("tblPeopleClientsSpringboardServices", "Springboard")
    Call CountDeletableRecords("tblPeopleClientsTransportationServices", "Transportation Services")
    Call CountDeletableRecords("tblPeopleClientsTRASEServices", "TRASE")
    Call CountDeletableRecords("tblPeopleClientsVocationalServices", "Vocational Services")
    Call CountDeletableRecords("tblPeopleClientsDemographics", "Demographics")
    Call CountDeletableRecords("tblPeopleClientsVendors", "Vendor")
End Sub

Private Sub CopyAndDeleteAllClientData()
    Call CopyAndDeleteClientFamilyRecord
    Call CopyAndDeleteClientAdultCoachingRecord
    Call CopyAndDeleteClientAdultCompanionRecord
    Call CopyAndDeleteClientAutismRecord
    Call CopyAndDeleteClientCLORecord
    Call CopyAndDeleteClientCommunityConnectionsRecord
    Call CopyAndDeleteClientDayServicesRecord
    Call CopyAndDeleteClientISSRecord
    Call CopyAndDeleteClientNHDayRecord
    Call CopyAndDeleteClientNHResRecord
    Call CopyAndDeleteClientPCARecord
    Call CopyAndDeleteClientResidentialRecord
    Call CopyAndDeleteClientSharedLivingRecord
    Call CopyAndDeleteClientSpringboardRecord
    Call CopyAndDeleteClientTransportationRecord
    Call CopyAndDeleteClientTRASERecord
    Call CopyAndDeleteClientVocationalRecord
    Call CopyAndDeleteClientDemographicsRecord
    Call CopyAndDeleteClientVendorsRecord
    Call UpdateChangeLog("CLIENT SERVICE RECORD(S) DELETED", "")
End Sub

Private Function Button_NavigationState() As Boolean
    Button_NavigationState = True
    If ResetPeopleRecordButtons Then
        SelectPersonByLastName.RowSource = "SELECT Person FROM qryPeopleAllPeopleRecords ORDER BY IndexedName;"
        SelectPersonByFirstName.RowSource = "SELECT PersonByFirstName FROM qryPeopleAllPeopleRecords ORDER BY FirstName, LastName;"
        Me.RecordSource = "SELECT tblPeople.* FROM tblPeople ORDER BY IndexedName;": Me.Requery: ResetPeopleRecordButtons = False
    End If
End Function

Private Function RecordNavigation(WhichButton As Integer, Optional ExitForm As Integer = 0) As Boolean
On Error GoTo ShowMeError
    RecordNavigation = True
    ' Check that the person has a person category selected.
    If Not SelectCriteriaLocked And Not ((IsClient And _
            (IsClientAutism Or IsCilentCLO Or IsClientDay Or IsClientIndiv Or IsClientAdultComp Or IsClientAdultCoach Or IsClientNHDay Or IsClientNHRes Or _
             IsClientPCA Or IsClientRes Or IsClientSharedLiving Or IsClientTrans Or IsClientCommunityConnections Or IsClientSpring Or IsClientTRASE Or _
             IsClientVocat)) Or IsFamilyGuardian Or IsDonor Or IsInterestedParty Or IsStaff Or IsConsultant) Then
        RecordNavigation = False
        MsgBox "This individual does not have a person category selected." & vbCrLf & "You must select at least one person category (and a client subcategory if the person is a client) before continuing.", vbOKOnly, "ERROR!"
        Exit Function
    End If
    ' All good.  Continue.
    If ExitForm = 1 Then Exit Function
    If Not Button_NavigationState Then Exit Function
    DoCmd.GoToRecord , , WhichButton
    Me.SetFocus
    SelectPersonByLastName.SetFocus
    Exit Function
ShowMeError:
    MsgBox "Can't go any further.", vbOKOnly, "ERROR!"
    RecordNavigation = False
End Function

Private Sub Button_JumpConsultant_Click()
    Form_frmPeopleConsultants.SetFocus
End Sub

Private Sub Button_JumpDonor_Click()
    Form_frmPeopleDonors.SetFocus
End Sub

Private Sub Button_JumpToClientFromFamily_Click()
On Error GoTo ShowMeError
    Dim rst As DAO.Recordset
  
    ClientJumpName = Form_frmPeopleFamily.ClientIndexedName
    FilterCriteria = "<Show All>": Call FilterCriteria_AfterUpdate
    Set rst = Me.RecordsetClone: rst.FindFirst "IndexedName = """ & ClientJumpName & """"
    Me.Bookmark = rst.Bookmark: ClientJumpFromFamily = False: Me.Refresh: Me.SetFocus
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub Button_NewRecord_Click()
On Error GoTo ShowMeError
    Dim rst As DAO.Recordset, ResultIndexedName As Variant
    ' Open new person data form and wait until done.
    DoCmd.OpenForm "frmPeopleEnterAndValidatePerson"
    Do Until CurrentProject.AllForms("frmPeopleEnterAndValidatePerson").IsLoaded = False
        DoEvents
    Loop
    If IsNull(Form_frmMainMenu.NewPersonIndexedName) Then Exit Sub
    ' Go to the new record.
    With Me
        .Filter = "IndexedName = """ & Form_frmMainMenu.NewPersonIndexedName & """"
        .FilterOn = True
        .IsClient.Visible = True
        .IsFamilyGuardian.Visible = True
        .IsDonor.Visible = True
        .IsInterestedParty.Visible = True
        .IsStaff.Visible = True
        .IsConsultant.Visible = True
        .TimerInterval = 0
        Form_frmMainMenu.NewRecordInProgress = False
        .Button_FirstRecord.Visible = True
        .Button_PreviousRecord.Visible = True
        .Button_NextRecord.Visible = True
        .Button_LastRecord.Visible = True
        .FilterCriteria.Visible = True
        If Form_frmMainMenu.StaffOnly Then .FilterCriteria.Visible = False
        .PeopleCount = DCount("IndexedName", "tblPeople", "[IndexedName] Not Like '///*'")
        .AllowAdditions = False
        .AllowDeletions = False
        .Button_NewRecord.Visible = True
    End With
    ' Open address entry form and wait until done.
    DoCmd.OpenForm "frmPeopleEnterAndValidateAddress"
    Do Until CurrentProject.AllForms("frmPeopleEnterAndValidateAddress").IsLoaded = False
        DoEvents
    Loop
    Me.FilterOn = False
    Set rst = Me.RecordsetClone
    rst.FindFirst "IndexedName = """ & Form_frmMainMenu.NewPersonIndexedName & """"
    Me.Bookmark = rst.Bookmark
    Form_frmMainMenu.NewPersonIndexedName = Null
    HomePhone.SetFocus
    If AddFamilyMemberToClient Then
        IsFamilyGuardian = True
        frmPeopleFamily.Visible = True
    End If
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub Button_ShowLocationPage_Click()
    DoCmd.OpenForm "frmLocations", acNormal, , "CityTown=""" & OfficeCityTown & """ AND LocationName=""" & OfficeLocationName & """"
End Sub

Private Sub Button_ShowOpenPositions_Click()
    DoCmd.OpenForm "frmPeopleShowOpenStaffPositions"
End Sub

' *************************
' * Check box processing. *
' *************************

Private Sub IsClient_Click()
On Error GoTo ShowMeError
    DoCmd.SetWarnings False
    DoCmd.OpenForm "frmPleaseWait"
    If IsClient Then
        If Not ChecksAndBalances Then
            IsClient = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as a Client. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsClient = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as a Client. Proceed?", vbYesNo, "Verify") = vbNo Then IsClient = True
        Form_frmPeople.SetFocus
    End If
    
    If IsClient Then
        If Left(IndexedName, 3) = "///" Then
            MsgBox "A company or organization cannot be a client.", vbOKOnly, "Error"
            IsClient = False
        Else
            Call ProcessPersonCategory(IsClient, "Client", "frmPeopleClientsDemographics")
            Call ProcessPersonCategory(IsClient, "Client", "frmPeopleClientsVendors")
            Call UpdateChangeLog("IsClient", "True")
        End If
    Else
        IsClient = False
        IsClientDay = False:                  Form_frmPeopleClientsDemographics.DayServices = False
        IsClientRes = False:                  Form_frmPeopleClientsDemographics.ResidentialServices = False
        IsClientTrans = False:                Form_frmPeopleClientsDemographics.TransportationServices = False
        IsClientVocat = False:                Form_frmPeopleClientsDemographics.VocationalServices = False
        IsClientSharedLiving = False:         Form_frmPeopleClientsDemographics.SharedLiving = False
        IsCilentCLO = False:                  Form_frmPeopleClientsDemographics.CLO = False
        IsClientIndiv = False:                Form_frmPeopleClientsDemographics.IndivSupport = False
        IsClientAdultComp = False:            Form_frmPeopleClientsDemographics.AdultComp = False
        IsClientAdultCoach = False:           Form_frmPeopleClientsDemographics.AdultCoach = False
        IsClientNHDay = False:                Form_frmPeopleClientsDemographics.NHDay = False
        IsClientNHRes = False:                Form_frmPeopleClientsDemographics.NHRes = False
        IsClientAutism = False:               Form_frmPeopleClientsDemographics.AutismServices = False
        IsClientPCA = False:                  Form_frmPeopleClientsDemographics.PCA = False
        IsClientSpring = False:               Form_frmPeopleClientsDemographics.SPRINGBOARD = False
        IsClientTRASE = False:                Form_frmPeopleClientsDemographics.TRASE = False
        IsClientCommunityConnections = False: Form_frmPeopleClientsDemographics.CommunityConnections = False
        
        Call CloseForm("frmPeopleClientsDemographics")
        Call CloseForm("frmPeopleClientsVendors")
        Call UpdateChangeLog("IsClient", "False")
        Form_frmPeople.SetFocus
    End If
    DoCmd.Close acForm, "frmPleaseWait"
    DoCmd.SetWarnings True
    Exit Sub
ShowMeError:
    DoCmd.Close acForm, "frmPleaseWait"
    DoCmd.SetWarnings True
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub IsConsultant_Click()
On Error GoTo ShowMeError
    If IsConsultant Then
        If Not ChecksAndBalances Then
            IsConsultant = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as a Consultant. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsConsultant = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as a Consultant. Proceed?", vbYesNo, "Verify") = vbNo Then IsConsultant = True
    End If

    If IsConsultant Then
        Call ProcessPersonCategory(IsConsultant, "Consultant", "frmPeopleConsultants")
        Call UpdateChangeLog("IsConsultant", "True")
    Else
        Call UpdateChangeLog("IsConsultant", "False")
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub IsDonor_Click()
On Error GoTo ShowMeError
    If IsDonor Then
        If Not ChecksAndBalances Then
            IsDonor = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as a Donor. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsDonor = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as a Donor. Proceed?", vbYesNo, "Verify") = vbNo Then IsDonor = True
    End If
  
    If IsDonor Then
        Call ProcessPersonCategory(IsDonor, "Donor", "frmPeopleDonors")
        Call UpdateChangeLog("IsDonor", "True")
    Else
        Call CloseForm("frmPeopleDonors")
        Call UpdateChangeLog("IsDonor", "False")
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub IsFamilyGuardian_Click()
On Error GoTo ShowMeError
    If IsFamilyGuardian Then
        If Not ChecksAndBalances Then
            IsFamilyGuardian = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as a Family Member/Guardian. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsFamilyGuardian = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as a Family Member/Guardian. Proceed?", vbYesNo, "Verify") = vbNo Then IsFamilyGuardian = True
    End If
    
    If IsFamilyGuardian Then
        Call ProcessPersonCategory(IsFamilyGuardian, "Family", "Skip")
        Call UpdateChangeLog("IsFamilyGuardian", "True")
        TILLEGram = True
    Else
        frmPeopleFamily.Visible = False
        Call UpdateChangeLog("IsFamilyGuardian", "False")
        TILLEGram = False
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub IsInterestedParty_Click()
On Error GoTo ShowMeError
    If IsInterestedParty Then
        If Not ChecksAndBalances Then
            IsInterestedParty = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as an Interested Party. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsInterestedParty = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as an Interested Party. Proceed?", vbYesNo, "Verify") = vbNo Then IsInterestedParty = True
    End If
  
    If IsInterestedParty Then
        Call ProcessPersonCategory(IsInterestedParty, "Interested", "SKIP")
        Call UpdateChangeLog("IsInterestedParty", "True")
    Else
        InterestedPartyCategory = "": InterestedPartyCategory.Visible = False: InterestedPartyInactive.Visible = False
        Call UpdateChangeLog("IsInterestedParty", "False")
        Call CheckPersonCompletelyInactive
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub IsStaff_Click()
On Error GoTo ShowMeError
    If IsStaff Then
        If Not ChecksAndBalances Then
            IsStaff = False
            Exit Sub
        End If
        If MsgBox("You are about to add this individual as a Staff. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsStaff = False
            Exit Sub
        End If
    Else
        If MsgBox("You are about to remove this individual as a Staff. Proceed?", vbYesNo, "Verify") = vbNo Then IsStaff = True
    End If

    If IsStaff Then
        NoMailings.Visible = False: GoGreen.Visible = False: Comment.Visible = True: FamiliarGreeting.Visible = False
        Call ProcessPersonCategory(IsStaff, "Staff", "SKIP")
        Call UpdateChangeLog("IsStaff", "True")
    Else
        Call UpdateChangeLog("IsStaff", "False")
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub MakeDeceasedInactive(FormField As Form, FormFieldLabel As Label)
    FormField.Inactive = True
    Call GreyAndNormal(FormFieldLabel)
End Sub

Private Sub IsDeceased_Click()
On Error GoTo ShowMeError
    Dim Subject As String, TextBody As String, PersonType As String
  
    If IsDeceased Then
        If MsgBox("You are about to set this person as deceased. Proceed?", vbYesNo, "Verify") = vbNo Then
            IsDeceased = False
            Call UpdateChangeLog("IsDeceased", "False")
        Else
            DeceasedDate.Visible = IsDeceased
            PersonType = " "
            If IsClient Then
                PersonType = PersonType & "Client ": Call GreyAndNormal(IsClientLabel): Call MakeDeceasedInactiveAll
            End If
            If IsFamilyGuardian Then PersonType = PersonType & "Family/Guardian "
            If IsDonor Then PersonType = PersonType & "Donor "
            If IsInterestedParty Then
                PersonType = PersonType & "Interested Party ": InterestedPartyInactive = True: Call GreyAndNormal(IsInterestedPartyLabel)
            End If
            If IsStaff Then PersonType = PersonType & "Staff "
            If IsConsultant Then
                PersonType = PersonType & "Consultant ": Form_frmPeopleConsultants.Inactive = True: Call GreyAndNormal(IsConsultantLabel)
            End If
            MsgBox "Please be sure to set a date of death in the Deceased Date field." & vbCrLf & "DO NOT REMOVE THE DECEASED PERSON FROM ITS PREVIOUS CATEGORIES!!!", vbOKOnly
            DeceasedDate.SetFocus
            Call UpdateChangeLog("IsDeceased", "True")
            Subject = "TILLDB: Deceased Person Notification"
            TextBody = FirstName & " " & LastName & " (" & PersonType & ") was flagged as DECEASED by " & Form_frmMainMenu.UserName & "."
            Call SendEmailMessage("tilldbnotifications@tillinc.org", DLookup("ParameterValue", "appParameters", "ID=22"), "db.deceased@tillinc.org", Null, Subject, TextBody, Null)
            If IsClientSpring Then Call SendEmailMessage("tilldbnotifications@tillinc.org", DLookup("ParameterValue", "appParameters", "ID=22"), "db.springboard@tillinc.org", Null, Subject, TextBody, Null)
        End If
    Else
        Call UpdateChangeLog("IsDeceased", "False")
    End If
    Form_frmPeople.SetFocus
    Exit Sub
ShowMeError:
    If Err.Number = 438 Then Exit Sub
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
    MsgBox TILLDBErrorMessage, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub MakeDeceasedInactiveAll()
    If IsClientAutism Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceAutism, IsClientLabel)
    If IsCilentCLO Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceCLO, IsCilentCLOLabel)
    If IsClientDay Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceDay, IsClientDayLabel)
    If IsClientIndiv Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceIndividualSupport, IsClientIndivLabel)
    If IsClientAdultComp Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceAdultCompanion, IsClientAdultCompLabel)
    If IsClientAdultCoach Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceAdultCoaching, IsClientAdultCoachLabel)
    If IsClientNHDay Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceNHDay, IsClientNHDayLabel)
    If IsClientNHRes Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceNHRes, IsClientNHResLabel)
'   If IsClientPCA Then Call MakeDeceasedInactive(Form_frmPeopleClientsServicePCA, IsClientPCALabel)
    If IsClientRes Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceResidential, IsClientResLabel)
    If IsClientSharedLiving Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceSharedLiving, IsClientSharedLivingLabel)
    If IsClientTrans Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceTransportation, IsClientTransLabel)
'   If IsClientCommunityConnections Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceCommunityConnections, IsClientCommunityConnectionsLabel)
    If IsClientSpring Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceSpringboard, IsClientSpringLabel)
'   If IsClientTRASE Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceTRASE, IsClientTRASELabel)
    If IsClientVocat Then Call MakeDeceasedInactive(Form_frmPeopleClientsServiceVocational, IsClientVocatLabel)
End Sub

Private Sub GoGreen_Click()
    If GoGreen Then Call UpdateChangeLog("GoGreen", "True") Else Call UpdateChangeLog("GoGreen", "False")
End Sub

Private Sub NoMailings_Click()
    If NoMailings Then Call UpdateChangeLog("NoMailings", "True") Else Call UpdateChangeLog("NoMailings", "False")
End Sub

Private Sub NoSolicitations_Click()
    If NoSolicitations Then Call UpdateChangeLog("NoSolicitations", "True") Else Call UpdateChangeLog("NoSolicitations", "False")
End Sub

Private Sub TILLEgram_Click()
    If TILLEGram Then Call UpdateChangeLog("TILLEgram", "True") Else Call UpdateChangeLog("TILLEgram", "False")
End Sub

' *************************
' * Repetitive functions. *
' *************************

Private Sub UnlockPeopleCategories()
    IsClient.Locked = False: IsClient.Visible = True: NumFamily.Visible = False: IsFamilyGuardian.Locked = False: IsFamilyGuardian.Visible = True
    IsDonor.Locked = False: IsDonor.Visible = True: NumDonations.Visible = False: IsInterestedParty.Locked = False: IsInterestedParty.Visible = True
    IsStaff.Locked = False: IsStaff.Visible = True: IsConsultant.Locked = False: IsConsultant.Visible = True: IsDeceased.Locked = False
End Sub

Private Sub UnlockPeopleFields()
    Call MakeFieldVisible(PhysicalAddress, False)
    Call MakeFieldVisible(PhysicalCity, False)
    Call MakeFieldVisible(PhysicalState, False)
    Call MakeFieldVisible(PhysicalZIP, False)
    Call MakeFieldVisible(MailingAddress, False)
    Call MakeFieldVisible(MailingCity, False)
    Call MakeFieldVisible(MailingState, False)
    Call MakeFieldVisible(MailingZIP, False)
    Call MakeFieldVisible(HomePhone, False)
    Call MakeFieldVisible(WorkPhone, False)
    Call MakeFieldVisible(MobilePhone, False)
    Call MakeFieldVisible(EmailAddress, False)
    OfficeCityTown.Visible = False: OfficeLocationName.Visible = False: StaffTitle.Visible = False: GPSuperCode.Visible = False: Department.Visible = False: DID.Visible = False: HasPhoneOnDesktop.Visible = False: StaffExtPhone.Visible = False: StaffPositionIsOpen.Visible = False
    IsDeceased.Visible = True: DeceasedDate.Visible = IsDeceased
    Form_frmMainMenu.NewRecordInProgress = False
    TILLEGram.Visible = True: NoMailings.Visible = True: GoGreen.Visible = True: Comment.Visible = True
End Sub

Private Sub SetFamiliarGreeting()
    If IsNull(Salutation) Then
        FirstName = SpecialNames(FirstName): FamiliarGreeting = FirstName
    Else
        LastName = SpecialNames(LastName):   FamiliarGreeting = RTrim(Salutation) & " " & LastName
    End If
    Call UpdateChangeLog("FamiliarGreeting-AutoSet", FamiliarGreeting)
End Sub

Private Sub ValidatePhysicalAddress()
On Error GoTo ShowMeError
    Call SetPhysicalAddressColor("Yellow")
    If ValidateAddress(PhysicalAddress, PhysicalCity, PhysicalState, PhysicalZIP, PhysicalAddressValidated, Me, CongressionalDistrict) Then
        DoCmd.OpenForm "frmPeopleAddressMaintenance"
        Do Until CurrentProject.AllForms("frmPeopleAddressMaintenance").IsLoaded = False
            DoEvents
        Loop
        PhysicalAddress = GlobalAddress: PhysicalCity = GlobalCity: PhysicalState = GlobalState: PhysicalZIP = GlobalZIP: PhysicalAddressValidated = GlobalValidated: CongressionalDistrict = GlobalCongressionalDistrict
        AfterFullPhysicalAddress = PhysicalAddress & "; " & PhysicalCity & " " & PhysicalState & " " & PhysicalZIP
    End If
    If PhysicalAddress.BackColor = RGB(0, 255, 0) Then PhysicalAddressValidated = True
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
    MsgBox TILLDBErrorMessage, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub ValidateMailingAddress()
On Error GoTo ShowMeError
    Call SetMailingAddressColor("Yellow")
    If ValidateAddress(MailingAddress, MailingCity, MailingState, MailingZIP, MailingAddressValidated, Me, MailingCongressionalDistrict) Then
        DoCmd.OpenForm "frmPeopleAddressMaintenance"
        Do Until CurrentProject.AllForms("frmPeopleAddressMaintenance").IsLoaded = False
            DoEvents
        Loop
        MailingAddress = GlobalAddress: MailingCity = GlobalCity: MailingState = GlobalState: MailingZIP = GlobalZIP: MailingAddressValidated = GlobalValidated
        AfterFullMailingAddress = MailingAddress & "; " & MailingCity & " " & MailingState & " " & MailingZIP
    End If
    If MailingAddress.BackColor = RGB(0, 255, 0) Then MailingAddressValidated = True
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
    MsgBox TILLDBErrorMessage, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub ProcessDonor()
    Call ProgressMessages("Append", "   Individual is a donor.")
    ' Don't allow the Anonymous Donor user to be altered.
    If IndexedName = "///Anonymous or Unknown" Then
        If Not Form_frmMainMenu.NewRecordInProgress Then
            IsClient.Locked = True: IsFamilyGuardian.Locked = True: IsDonor = True: IsDonor.Locked = True: IsInterestedParty.Locked = True
            IsStaff.Locked = True: IsConsultant.Locked = True: IsDeceased = False: IsDeceased.Locked = True
        End If
    End If
    NumDonations = DCount("IndexedName", "tblPeopleDonors", "IndexedName=""" & IndexedName & """"): Call BriefDelay
    If NumDonations = 0 And IsDonor And IndexedName <> "///Anonymous or Unknown" Then
        ErrorMessages = ErrorMessages & "[Sev Med] Individual is flagged as a Donor but has no donations recorded." & vbCrLf
        ErrorMessages.BackStyle = 1: ErrorMessages.Requery
    Else
        NumDonations.Visible = True: NumDonations.FontWeight = 700: NumDonations.ForeColor = RGB(0, 255, 255)
        DoCmd.OpenForm "frmPeopleDonors", , , "IndexedName=""" & IndexedName & """"
        Button_JumpDonor.Visible = True
    End If
    
    SearchUserName = DLookup("User", "catUserPermissions", "Action='Can flag deceased Donors' AND User='" & Form_frmMainMenu.UserName & "'")
    If SearchUserName = Form_frmMainMenu.UserName Then Call DeceasedLock("Unlock") Else Call DeceasedLock("Lock")
    If IsNull(FamiliarGreeting) Then Call SetFamiliarGreeting
    If Form_frmPeopleDonors.Inactive Then Call GreyAndNormal(IsDonorLabel) Else Call BlueAndBold(IsDonorLabel)
End Sub

Private Sub ProcessInterestedParty()
    Call ProgressMessages("Append", "   Individual is an interested party.")
    If Len(PhysicalZIP) < 10 Then PhysicalAddressValidated = False Else PhysicalAddressValidated = True
    If Len(MailingZIP) < 10 Then MailingAddressValidated = False Else MailingAddressValidated = True
    If Len(PhysicalZIP) = 0 Then PhysicalAddressValidated = True
    If Len(MailingZIP) = 0 Then MailingAddressValidated = True
    InterestedPartyCategory.Visible = True: InterestedPartyInactive.Visible = True
    If InterestedPartyInactive Then Call GreyAndNormal(IsInterestedPartyLabel) Else Call BlueAndBold(IsInterestedPartyLabel)
    
    SearchUserName = DLookup("User", "catUserPermissions", "Action='Can flag deceased IP' AND User='" & Form_frmMainMenu.UserName & "'")
    If SearchUserName = Form_frmMainMenu.UserName Then Call DeceasedLock("Unlock") Else Call DeceasedLock("Lock")

    If IsNull(FamiliarGreeting) Then Call SetFamiliarGreeting
End Sub

Private Sub ProcessClient()
    Dim NumGuardians As Variant

    Call ProgressMessages("Append", "   Individual is a client.")
    If ShowActiveOnly Then FilterClientSubcategory.Visible = False Else FilterClientSubcategory.Visible = True
    Call BlueAndBold(IsClientLabel)
    Button_JumpClient.Visible = True: Button_JumpVendors.Visible = True
    
    ' No demographics record?  Add one.
    If DCount("IndexedName", "tblPeopleClientsDemographics", "IndexedName = """ & IndexedName & """") <= 0 Then
        NewClient = True
        Call ProcessPersonCategory(IsClient, "Client", "frmPeopleClientsDemographics")
    End If
    
    ' No vendor record?  Add one.
    If DCount("IndexedName", "tblPeopleClientsVendors", "IndexedName = """ & IndexedName & """") <= 0 Then
        Call ProcessPersonCategory(IsClient, "Client", "frmPeopleClientsVendors")
    End If
    
    ' Determine if physical address has been validated.
    If Len(PhysicalZIP) = 0 Then
        PhysicalAddressValidated = True
    ElseIf Len(PhysicalZIP) < 10 Then
        PhysicalAddressValidated = False
    Else
        PhysicalAddressValidated = True
    End If
    
    ' Determine if mailing address has been validated.
    If Len(MailingZIP) = 0 Then
        MailingAddressValidated = True
    ElseIf Len(MailingZIP) < 10 Then
        MailingAddressValidated = False
    Else
        MailingAddressValidated = True
    End If
    
    ' Open Demographics page and set record creation metadata if not set.
    DoCmd.OpenForm "frmPeopleClientsDemographics"
    If IsNull(RecordAddedDate) Then
        If Not IsNull(Form_frmPeopleClientsDemographics.RecordAddedDate) Then
            RecordAddedDate = Form_frmPeopleClientsDemographics.RecordAddedDate
            RecordAddedBy = Form_frmPeopleClientsDemographics.RecordAddedBy
            Call UpdateChangeLog("Client Record Created", "")
        End If
    End If
    ' Show what services this client has.
    Call DisplayClientServices
    
    ' Show family/guardian/contacts.
    Call DisplayClientFamilyRecords(NumGuardians)
    
    ' Check if all services are inactive and flag accordingly.
    If ClientCompletelyInactive And Not IsDeceased Then AllServicesInactive.Visible = True Else AllServicesInactive.Visible = False
    ' Check Food Stamp Status.
    If Form_frmPeopleClientsDemographics.FoodStamps Then
        If IsNull(Form_frmPeopleClientsDemographics.FoodStampsNextCertDate) Then
            If Not IsDeceased Then
                ErrorMessages = ErrorMessages & "[Sev Med]   Client's next food stamp recertification date is not set." & vbCrLf & " " & vbCrLf
                ErrorMessages.BackStyle = 1
            End If
        Else
            If Not IsDeceased And DateDiff("d", Date, DateValue(Form_frmPeopleClientsDemographics.FoodStampsNextCertDate)) < 0 Then
                ErrorMessages = ErrorMessages & "[Sev Med] Food stamp recertification is overdue." & vbCrLf & " " & vbCrLf
                ErrorMessages.BackStyle = 1
            ElseIf Not IsDeceased And DateDiff("d", Date, DateValue(Form_frmPeopleClientsDemographics.FoodStampsNextCertDate)) < 30 Then
                ErrorMessages = ErrorMessages & "[Sev Med]   Food stamp recertification is due in " & DateDiff("d", Date, DateValue(Form_frmPeopleClientsDemographics.FoodStampsNextCertDate)) & " days." & vbCrLf & " " & vbCrLf
                ErrorMessages.BackStyle = 1
            End If
        End If
    End If

    If IsClientSpring Then
        SearchUserName = DLookup("User", "catUserPermissions", "Action='Can flag deceased Springboard' AND User='" & Form_frmMainMenu.UserName & "'")
        If SearchUserName = Form_frmMainMenu.UserName Then Call DeceasedLock("Unlock") Else Call DeceasedLock("Lock")
    Else
        SearchUserName = DLookup("User", "catUserPermissions", "Action='Can flag deceased Clients' AND User='" & Form_frmMainMenu.UserName & "'")
        If SearchUserName = Form_frmMainMenu.UserName Then Call DeceasedLock("Unlock") Else Call DeceasedLock("Lock")
    End If
    ' Update ResVendorLocation in Vendors table.
    Call UpdateVendorLocation
    ' Check dual eligible status.
    If Not IsNull(Form_frmPeopleClientsDemographics.MedicaidNumber) And Not IsNull(Form_frmPeopleClientsDemographics.MedicareNumber) Then
        Form_frmPeopleClientsDemographics.DualEligible = True
    Call DropTempTables
    End If
End Sub

Private Sub UpdateVendorLocation()
    If IsClientRes Then
        If Not Form_frmPeopleClientsServiceResidential.Inactive Then
            Form_frmPeopleClientsVendors.ResVendorLocation = ResLocation
        End If
    End If
    
    If IsCilentCLO Then
        If Not Form_frmPeopleClientsServiceCLO.Inactive Then
            Form_frmPeopleClientsVendors.ResVendorLocation = CLOLocation
        End If
    End If
    
    If IsClientIndiv Then
        If Not Form_frmPeopleClientsServiceIndividualSupport.Inactive Then
            Form_frmPeopleClientsVendors.ResVendorLocation = ""
        End If
    End If
End Sub

Private Sub DisplayClientFamilyRecords(NumGuardians As Variant)
    DoCmd.SetWarnings False
    Call DropTempTables
    NumFamily.Visible = True: NumFamily.FontWeight = 700: NumFamily.ForeColor = RGB(0, 255, 255): NumFamilyLabel.FontWeight = 700: NumFamilyLabel.ForeColor = RGB(0, 255, 255)
    Form_frmPeople.NumFamily = DCount("IndexedName", "tblPeopleFamily", "ClientIndexedName='" & Form_frmPeople.IndexedName & "'")
    If NumFamily > 0 Then
        frmPeopleClientsContacts.Visible = True
        frmPeopleClientsContacts.Requery
        NumGuardians = DCount("IndexedName", "tblPeopleFamily", "tblPeopleFamily.Guardian = True AND tblPeopleFamily.ClientIndexedName='" & Form_frmPeople.IndexedName & "'")
        Select Case Form_frmPeopleClientsDemographics.LegalStatus
            Case "Incompetent"
                If Not IsDeceased And NumGuardians = 0 Then
                    ErrorMessages = ErrorMessages & "[Sev High] Client's legal status is Incompetent but client has no guardians." & vbCrLf & " " & vbCrLf
                    ErrorMessages.BackStyle = 1
                End If
            Case "Competent", "Presumed Competent"
                If Not IsDeceased And NumGuardians <> 0 Then
                    ErrorMessages = ErrorMessages & "[Sev High] Client's legal status is Competent or Presumed Competent but client has at least one guardian." & vbCrLf & " " & vbCrLf
                    ErrorMessages.BackStyle = 1
                End If
            Case "Minor"
                If Not IsDeceased And NumGuardians = 0 Then
                    ErrorMessages = ErrorMessages & "[Sev High] Client's legal status is Minor but client has no guardians." & vbCrLf & " " & vbCrLf
                    ErrorMessages.BackStyle = 1
                End If
            Case Else
        End Select
    Else
        frmPeopleClientsContacts.Visible = False
        Select Case Form_frmPeopleClientsDemographics.LegalStatus
            Case "Incompetent"
                If Not IsDeceased Then
                    ErrorMessages = ErrorMessages & "[Sev High] Client's legal status is Incompetent but client has no guardians." & vbCrLf & " " & vbCrLf
                    ErrorMessages.BackStyle = 1
                End If
            Case "Minor"
                If Not IsDeceased Then
                    ErrorMessages = ErrorMessages & "[Sev High] Client's legal status is Minor but client has no guardians." & vbCrLf & " " & vbCrLf
                    ErrorMessages.BackStyle = 1
                End If
            Case Else
        End Select
    End If
    DoCmd.SetWarnings True
End Sub

Private Sub ProcessFamily()
    Call ProgressMessages("Append", "   Individual is a family member or guardian.")
    Call DeceasedLock("Unlock")
    Button_JumpToClientFromFamily.Visible = True
    If DCount("Inactive", "tblPeopleFamily", "Inactive = False AND IndexedName=""" & IndexedName & """") > 0 Then Call BlueAndBold(IsFamilyGuardianLabel) Else Call GreyAndNormal(IsFamilyGuardianLabel)
    If Form_frmMainMenu.StaffOnly Then
        frmPeopleFamily.Visible = False
        Button_JumpToClientFromFamily.Visible = False
    Else
        If Len(PhysicalZIP) < 10 Then PhysicalAddressValidated = False Else PhysicalAddressValidated = True
        If Len(MailingZIP) < 10 Then MailingAddressValidated = False Else MailingAddressValidated = True
        If Len(PhysicalZIP) = 0 Then PhysicalAddressValidated = True
        If Len(MailingZIP) = 0 Then MailingAddressValidated = True
        frmPeopleFamily.Visible = True
        Button_JumpToClientFromFamily.Visible = True
    End If
    If IsNull(FamiliarGreeting) Then Call SetFamiliarGreeting
End Sub

Private Sub ProcessStaff()
    Dim ManagerFirstName As Variant, ManagerLastName As Variant
    ' Initialize the page
    Call ProgressMessages("Append", "   Individual is a staff member.")
    Call BlueAndBold(IsStaffLabel)
    Salutation.Visible = False: FamiliarGreeting.Visible = False: PhysicalAddress.Visible = False: PhysicalCity.Visible = False: PhysicalState.Visible = False
    PhysicalZIP.Visible = False: MailingAddress.Visible = False: MailingCity.Visible = False: MailingState.Visible = False: MailingZIP.Visible = False
    HomePhone.Visible = False: WorkPhone.Visible = False: MobilePhone.Visible = False: EmailAddress.Visible = False
    StaffEmailAddress.Visible = True: DID.Visible = False: ManagerSupervisor.Visible = False: SigningAuthority.Visible = False: ContractStaff.Visible = False: ContractOwner.Visible = False
    ' Skip all other processing if the entry is a VMBOX.
    If StaffTitle = "VMBox" Then
        DID.Visible = True
        StaffExtPhone.Visible = True
        Comment.Visible = True
        Exit Sub
    End If
    ' Initialize all staff-specific fields.
    ManagerSupervisor.Visible = True: SigningAuthority.Visible = True: StaffTitle.Visible = True
    OfficeCityTown.Visible = True: OfficeLocationName.Visible = True: Department.Visible = True
    ' Lookup the manager/supervisor first and last names.
    ManagerFirstName = DLookup("FirstName", "tblPeople", "GPSupercode = """ & ManagerSuperCode & """ AND FirstName <> ""TBD""")
    ManagerLastName = DLookup("LastName", "tblPeople", "GPSupercode = """ & ManagerSuperCode & """ AND FirstName <> ""TBD""")
    If IsNull(ManagerFirstName) And IsNull(ManagerFirstName) Then
        ManagerSupervisor = "No staff record in GP."
        ManagerSupervisor.ForeColor = RGB(255, 0, 0)
    Else
        ManagerSupervisor = ManagerFirstName & " " & ManagerLastName
        ManagerSupervisor.ForeColor = RGB(0, 0, 0)
    End If
    
    If DCount("Action", "catUserPermissions", "User='" & Form_frmMainMenu.UserName & "' AND Action='Can see Signing Authority'") > 0 Then SigningAuthority.Visible = True Else SigningAuthority.Visible = False
    ContractStaff.Visible = True: ContractOwner.Visible = True
    
    If IsNull(GPSuperCode) Or Len(GPSuperCode) = 0 Then GPSuperCode.Visible = False Else GPSuperCode.Visible = True
    If (OfficeCityTown = "Dedham" And Not (OfficeLocationName = "Gibson Avenue" Or OfficeLocationName = "Washington Street")) Then DID.Visible = True Else DID.Visible = False
    HasPhoneOnDesktop.Visible = DID.Visible
    StaffExtPhone.Visible = True
    
    IsDeceased.Visible = False: TILLEGram = False: TILLEGram.Visible = False: NoMailings.Visible = False: GoGreen.Visible = False: Comment.Visible = True
    
    Button_ShowOpenPositions.Visible = True: StaffPositionIsOpen.Visible = True: StaffPositionIsOpen = False
    
    If IsNull(StaffLocation) Or Len(StaffLocation) <= 0 Then StaffLocation = OfficeCityTown & "-" & OfficeLocationName
    
    If FirstName = "TBD" Then Call ProcessOpenStaffPosition
    
    Select Case Department
        Case "Residential Services", "Day Services", "Vocational Services", "Individualized Support Options":   Button_ShowLocationPage.Visible = True
        Case Else:                                                                                              Button_ShowLocationPage.Visible = False
    End Select
    
    ' Check information from Locations table if needed.
    If DCount("LocationName", "tblLocations", "LocationName=""" & OfficeLocationName & """") > 0 Then
        If DLookup("CityTown", "tblLocations", "CityTown=""" & OfficeCityTown & """") = "Dedham" Then
            If Left(DLookup("LocationName", "tblLocations", "LocationName=""" & OfficeLocationName & """"), 6) = "Gibson" Or _
               Left(DLookup("LocationName", "tblLocations", "LocationName=""" & OfficeLocationName & """"), 6) = "Washin" Then
                DID = DLookup("DID", "tblLocations", "LocationName=""" & OfficeLocationName & """")
            End If
        Else
            DID = DLookup("DID", "tblLocations", "LocationName=""" & OfficeLocationName & """")
        End If
    End If
End Sub

Private Sub ProcessOpenStaffPosition()
On Error GoTo ShowMeError
    Dim Criteria As Variant, ManagerFirstName As Variant, ManagerLastName As Variant
    
    DoCmd.SetWarnings False
    DoCmd.OpenForm "frmPleaseWaitBrief"
    ' Set the staff position open flag.
    StaffPositionIsOpen = True
    ' Process only if it's a program manager.
    If (StaffTitle = "Residence Manager" Or StaffTitle = "Site Coordinator") Or Department = "Day Habilitation" Or Department = "TILL Central" Then
        ' Set the supervisor code to the supervisor's supervisor.
        Criteria = "CityTown='" & OfficeCityTown & "' AND LocationName = '" & OfficeLocationName & "'"
        GPSuperCode = DLookup("GPSuperCode", "tblPeople", "IndexedName=""" & DLookup("StaffSecondaryContactIndexedName", "tblLocations", Criteria) & """")
        ManagerFirstName = DLookup("FirstName", "tblPeople", "GPSupercode = """ & GPSuperCode & """ AND FirstName <> ""TBD""")
        ManagerLastName = DLookup("LastName", "tblPeople", "GPSupercode = """ & GPSuperCode & """ AND FirstName <> ""TBD""")
        ManagerSupervisor = ManagerFirstName & " " & ManagerLastName
        ManagerSuperCode = ""
        Call BriefDelay
        ' Update the Locations Table.
        TILLDataBase.Execute "UPDATE tblLocations SET tblLocations.StaffPrimaryContactIndexedName = """ & IndexedName & """, tblLocations.StaffPrimaryContactLastName = """ & LastName & """, tblLocations.StaffPrimaryContactFirstName = """ & FirstName & """, tblLocations.StaffPrimaryContactMiddleInitial = """ & MiddleInitial & """" & _
            "WHERE tblLocations.CityTown= """ & OfficeCityTown & """ AND tblLocations.LocationName= """ & OfficeLocationName & """;", dbSeeChanges: Call BriefDelay
        Call BriefDelay
        DoCmd.Close acForm, "frmPleaseWaitBrief"
        Me.Refresh
        DoCmd.SetWarnings True
    End If
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub ProcessConsultant()
    Call ProgressMessages("Append", "   Individual is a consultant.")
    Call BlueAndBold(IsConsultantLabel)
    If Len(PhysicalZIP) < 10 Then PhysicalAddressValidated = False Else PhysicalAddressValidated = True
    If Len(MailingZIP) < 10 Then MailingAddressValidated = False Else MailingAddressValidated = True
    If Len(PhysicalZIP) = 0 Then PhysicalAddressValidated = True
    If Len(MailingZIP) = 0 Then MailingAddressValidated = True
    DoCmd.OpenForm "frmPeopleConsultants", , , "IndexedName=""" & IndexedName & """"
    Button_JumpConsultant.Visible = True
End Sub

Private Sub SetPhysicalAddressColor(Color As String)
    Select Case Color
        Case "Yellow"
            PhysicalAddress.BackColor = RGB(255, 255, 0): PhysicalCity.BackColor = RGB(255, 255, 0): PhysicalState.BackColor = RGB(255, 255, 0): PhysicalZIP.BackColor = RGB(255, 255, 0)
        Case "Green"
            PhysicalAddress.BackColor = RGB(0, 255, 0): PhysicalCity.BackColor = RGB(0, 255, 0): PhysicalState.BackColor = RGB(0, 255, 0): PhysicalZIP.BackColor = RGB(0, 255, 0)
        Case "Red"
            PhysicalAddress.BackColor = RGB(255, 0, 0): PhysicalCity.BackColor = RGB(255, 0, 0): PhysicalState.BackColor = RGB(255, 0, 0): PhysicalZIP.BackColor = RGB(255, 0, 0)
        Case "White"
            PhysicalAddress.BackColor = RGB(255, 255, 255): PhysicalCity.BackColor = RGB(255, 255, 255): PhysicalState.BackColor = RGB(255, 255, 255): PhysicalZIP.BackColor = RGB(255, 255, 255)
    End Select
End Sub

Private Sub SetMailingAddressColor(Color As String)
    Select Case Color
        Case "Yellow"
            MailingAddress.BackColor = RGB(255, 255, 0): MailingCity.BackColor = RGB(255, 255, 0): MailingState.BackColor = RGB(255, 255, 0): MailingZIP.BackColor = RGB(255, 255, 0)
        Case "Green"
            MailingAddress.BackColor = RGB(0, 255, 0): MailingCity.BackColor = RGB(0, 255, 0): MailingState.BackColor = RGB(0, 255, 0): MailingZIP.BackColor = RGB(0, 255, 0)
        Case "Red"
            MailingAddress.BackColor = RGB(255, 0, 0): MailingCity.BackColor = RGB(255, 0, 0): MailingState.BackColor = RGB(255, 0, 0): MailingZIP.BackColor = RGB(255, 0, 0)
        Case "White"
            MailingAddress.BackColor = RGB(255, 255, 255): MailingCity.BackColor = RGB(255, 255, 255): MailingState.BackColor = RGB(255, 255, 255): MailingZIP.BackColor = RGB(255, 255, 255)
    End Select
End Sub

Private Sub BuildAllPeopleRecordsTable()
On Error GoTo ShowMeError
    DoCmd.SetWarnings False
    If IsTableQuery("AllPeopleRecords") Then TILLDataBase.Execute "DROP TABLE AllPeopleRecords", dbSeeChanges: Call BriefDelay
    DoCmd.OpenQuery "qryCreateAllPeopleTable"
'    TILLDataBase.Execute "SELECT LastName & ', ' & FirstName & ' ' & IIf(Len(MiddleInitial)>0,MiddleInitial,'') AS Person, FirstName & ' ' & IIf(Len(MiddleInitial)<=0,'',MiddleInitial & ' ') & LastName AS PersonByFirstName, tblPeople.* " & _
'        "INTO AllPeopleRecords FROM tblPeople WHERE Left(IndexedName,3) <> '///' ORDER BY tblPeople.IndexedName;", dbseechanges: call briefdelay
    InitialLoadAllPeopleRecords = True
    DoCmd.SetWarnings True
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub UpdateAllPeopleRecordsTable()
On Error GoTo ShowMeError
    DoCmd.SetWarnings False
    If InitialLoadAllPeopleRecords Then
        InitialLoadAllPeopleRecords = False
        Exit Sub
    End If
    If IsObjectOpen("AllPeopleRecords", 0) Then DoCmd.Close acTable, "AllPeopleRecords", acSaveNo
    If IsTableQuery("AllPeopleRecords") Then TILLDataBase.Execute "DROP TABLE AllPeopleRecords", dbSeeChanges: Call BriefDelay
    DoCmd.OpenQuery "qryUpdateAllPeopleTable"
'    TILLDataBase.Execute "SELECT LastName & ', ' & FirstName & ' ' & IIf(Len(MiddleInitial)>0,MiddleInitial,'') AS Person, FirstName & ' ' & IIf(Len(MiddleInitial)<=0,'',MiddleInitial & ' ') & LastName AS PersonByFirstName, tblPeople.* " & _
'        "INTO AllPeopleRecords FROM tblPeople WHERE Left(IndexedName,3) <> '///' ORDER BY tblPeople.IndexedName;", dbseechanges: call briefdelay
    DoCmd.SetWarnings True
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub ClearAllFilters_Click()
    FilterCriteria = "<Show all>": FilterClientSubcategory = Null: SelectPersonByLastName = Null: SelectCompany = Null: ShowActiveOnly = False: ShowActiveOnly.Visible = False
    Me.FilterOn = False: PeopleCount = DCount("IndexedName", "tblPeople"): PeopleCountLbl = "people and companies"
    Me.Refresh
End Sub

Private Sub ClientCounts_Click()
On Error GoTo ShowMeError
    Call DropTempTables
    SysCmdResult = SysCmd(4, "Counting active clients by program.")
    ActiveClientCount_AdultCoach = GetProgramClients("tblPeopleClientsAdultCoaching", "IsClientAdultCoach")
    ActiveClientCount_AdultComp = GetProgramClients("tblPeopleClientsAdultCompanion", "IsClientAdultComp")
    ActiveClientCount_CLO = GetProgramClients("tblPeopleClientsCLOServices", "IsCilentCLO")
    ActiveClientCount_Day = GetProgramClients("tblPeopleClientsDayServices", "IsClientDay")
    ActiveClientCount_Indiv = GetProgramClients("tblPeopleClientsIndividualSupportServices", "IsClientIndiv")
    ActiveClientCount_NHDay = GetProgramClients("tblPeopleClientsNHDay", "IsClientNHDay")
    ActiveClientCount_NHRes = GetProgramClients("tblPeopleClientsNHRes", "IsClientNHRes")
'   ActiveClientCount_CC = GetProgramClients("tblPeopleClientsCommunityConnectionsServices", "IsClientCommunityConnections")
    ActiveClientCount_Res = GetProgramClients("tblPeopleClientsResidentialServices", "IsClientRes")
    ActiveClientCount_SL = GetProgramClients("tblPeopleClientsSharedLivingServices", "IsClientSharedLiving")
    ActiveClientCount_Spring = GetProgramClients("tblPeopleClientsSpringboardServices", "IsClientSpring")
    ActiveClientCount_Voc = GetProgramClients("tblPeopleClientsVocationalServices", "IsClientVocat")
    Call BriefDelay(5)
    SysCmdResult = SysCmd(4, "Displaying report.  Please be patient as it take a few seconds for the calculations to be generated.")
    DoCmd.OpenForm "frmPeopleCounts"
    Call LoopUntilClosed("frmPeopleCounts", acForm)
    Call DropTempTables
    SysCmdResult = SysCmd(4, "People View")
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by " & Me.Name & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Private Sub ContinueProcessNewRecord()
    Me.Caption = "People": Me.AllowAdditions = True: Me.AllowDeletions = True
    Button_NewRecord.Visible = False: Button_FirstRecord.Visible = False: Button_PreviousRecord.Visible = False: Button_NextRecord.Visible = False: Button_LastRecord.Visible = False: Button_DeleteRecord.Visible = False
    FilterCriteria.Visible = False: Me.TimerInterval = 500: frmPeopleFamily.Visible = False: frmPeopleClientsContacts.Visible = False: InterestedPartyCategory.Visible = False: InterestedPartyInactive.Visible = False
    Call CloseAllPeopleForms(False)
    LastName = Null: FirstName = Null: MiddleInitial = Null: CompanyOrganization = Null: Title = Null: LowerCompany = Null
    IsDeceased.Visible = False: Salutation.Visible = False: Salutation.Enabled = True: LastName.Visible = False: FirstName.Visible = False: MiddleInitial.Visible = False
    DisplayName.Visible = False: Title.Visible = False: EnterTitle.Visible = False: LowerCompany.Visible = False: UpperCompany.Visible = False: EnterCompany.Visible = False
    Button_JumpDonor.Visible = False: Button_JumpClient.Visible = False: Button_JumpVendors.Visible = False: Button_JumpConsultant.Visible = False
    IsClient.Visible = False: IsFamilyGuardian.Visible = False: IsDonor.Visible = False: IsInterestedParty.Visible = False: IsStaff.Visible = False: IsConsultant.Visible = False
    
    Call MakeFieldVisible(PhysicalAddress, True): Call MakeFieldVisible(PhysicalCity, True): Call MakeFieldVisible(PhysicalState, True): Call MakeFieldVisible(PhysicalZIP, True)
    Call MakeFieldVisible(MailingAddress, True):  Call MakeFieldVisible(MailingCity, True):  Call MakeFieldVisible(MailingState, True):  Call MakeFieldVisible(MailingZIP, True)
    Call MakeFieldVisible(HomePhone, True):       Call MakeFieldVisible(WorkPhone, True):    Call MakeFieldVisible(MobilePhone, True):   Call MakeFieldVisible(EmailAddress, True)
    
    Call YellowAndNormal(IsClientLabel): Call YellowAndNormal(IsDonorLabel): Call YellowAndNormal(IsFamilyGuardianLabel): Call YellowAndNormal(IsStaffLabel): Call YellowAndNormal(IsInterestedPartyLabel): Call YellowAndNormal(IsDeceasedLabel)
    IndexedName = CorrectProperNames(StrConv([LastName], vbProperCase)) & "/" & CorrectProperNames(StrConv([FirstName], vbProperCase)) & "/" & StrConv([MiddleInitial], vbUpperCase) & "/" & [CompanyOrganization]
    SelectPersonByLastName.SetFocus
End Sub

Private Function ChecksAndBalances() As Boolean
    ChecksAndBalances = True
    If IsClient Then
        If IsFamilyGuardian Then If MsgBox("You are attempting to set this individual as both a client and a family member. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
        If IsDonor Then If MsgBox("You are attempting to set this individual as both a client and a donor. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
        If IsInterestedParty Then If MsgBox("You are attempting to set this individual as both a client and an interested party. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
        If IsStaff Then If MsgBox("You are attempting to set this individual as both a client and a TILL staff member. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
        If IsConsultant Then If MsgBox("You are attempting to set this individual as both a client and a TILL consultant. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
        If IsFamilyGuardian Then If MsgBox("You are attempting to set this individual as both a client and a family member. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
    End If
    If IsStaff Then If IsConsultant Then If MsgBox("You are attempting to set this individual as both a TILL staff member and a TILL consultant. Are you sure you want to do this?", vbYesNo, "Warning!") = vbNo Then ChecksAndBalances = False
End Function
 
' **************
' * Cosmetics. *
' **************
 
Private Sub SetLabelsNormal()
    IsClientAdultComp.Visible = False: IsClientAdultCoach.Visible = False: IsClientRes.Visible = False: IsCilentCLO.Visible = False: IsClientSharedLiving.Visible = False
    IsClientAFC.Visible = False: IsClientIndiv.Visible = False: IsClientDay.Visible = False: IsClientVocat.Visible = False: IsClientTrans.Visible = False
    IsClientAutism.Visible = False: IsClientDay.Visible = False: IsClientPCA.Visible = False: IsClientNHDay.Visible = False: IsClientNHRes.Visible = False
    IsClientCommunityConnections.Visible = False: IsClientSpring.Visible = False: IsClientTRASE.Visible = False
    
    Call YellowAndNormal(IsClientLabel): Call YellowAndNormal(IsDonorLabel): Call YellowAndNormal(IsFamilyGuardianLabel): Call YellowAndNormal(IsStaffLabel): Call YellowAndNormal(IsInterestedPartyLabel): Call YellowAndNormal(IsConsultantLabel): Call YellowAndNormal(IsDeceasedLabel)
End Sub
  
Private Sub MakeButtonsVisible()
    ' Set navigation buttons.
    Button_FirstRecord.Visible = True: Button_PreviousRecord.Visible = True: Button_LastRecord.Visible = True: Button_NextRecord.Visible = True
    If IndexedName = FirstPersonIndexedName Then
        Button_FirstRecord.Visible = False: Button_PreviousRecord.Visible = False
    ElseIf IndexedName = LastPersonIndexedName Then
        Button_LastRecord.Visible = False:  Button_NextRecord.Visible = False
    End If
    
    Button_NewRecord.Visible = True
    Button_ShowOpenPositions.Visible = False: Button_JumpDonor.Visible = False: Button_JumpClient.Visible = False: Button_JumpVendors.Visible = False
    Button_JumpConsultant.Visible = False: Button_JumpToClientFromFamily.Visible = False: Button_ShowLocationPage.Visible = False
    frmPeopleFamily.Visible = False: frmPeopleClientsContacts.Visible = False: Me.TimerInterval = 0
    ' Who Can delete records?
    Button_DeleteRecord.Visible = DCount("Action", "catUserPermissions", "User='" & Form_frmMainMenu.UserName & "' AND Action='Can delete records'") > 0
End Sub

Private Sub DisplayClientServices()
    IsClientRes.Visible = True: IsCilentCLO.Visible = True: IsClientSharedLiving.Visible = True: IsClientIndiv.Visible = True: IsClientAdultComp.Visible = True
    IsClientAdultCoach.Visible = True: IsClientDay.Visible = True: IsClientVocat.Visible = True: IsClientTrans.Visible = True
    IsClientDay.Visible = True: IsClientNHDay.Visible = True: IsClientNHRes.Visible = True
    IsClientSpring.Visible = True: IsClientTRASE.Visible = True
    IsClientPCA.Visible = False
    
    If IsClientRes Then If Form_frmPeopleClientsServiceResidential.Inactive Then Call GreyAndNormal(IsClientResLabel) Else Call BlueAndBold(IsClientResLabel) Else Call YellowAndNormal(IsClientResLabel)
    If IsCilentCLO Then If Form_frmPeopleClientsServiceCLO.Inactive Then Call GreyAndNormal(IsCilentCLOLabel) Else Call BlueAndBold(IsCilentCLOLabel) Else Call YellowAndNormal(IsCilentCLOLabel)
    If IsClientSharedLiving Then If Form_frmPeopleClientsServiceSharedLiving.Inactive Then Call GreyAndNormal(IsClientSharedLivingLabel) Else Call BlueAndBold(IsClientSharedLivingLabel) Else Call YellowAndNormal(IsClientSharedLivingLabel)
    If IsClientIndiv Then If Form_frmPeopleClientsServiceIndividualSupport.Inactive Then Call GreyAndNormal(IsClientIndivLabel) Else Call BlueAndBold(IsClientIndivLabel) Else Call YellowAndNormal(IsClientIndivLabel)
    If IsClientAdultComp Then If Form_frmPeopleClientsServiceAdultCompanion.Inactive Then Call GreyAndNormal(IsClientAdultCompLabel) Else Call BlueAndBold(IsClientAdultCompLabel) Else Call YellowAndNormal(IsClientAdultCompLabel)
    If IsClientAdultCoach Then If Form_frmPeopleClientsServiceAdultCoaching.Inactive Then Call GreyAndNormal(IsClientAdultCoachLabel) Else Call BlueAndBold(IsClientAdultCoachLabel) Else Call YellowAndNormal(IsClientAdultCoachLabel)
    If IsClientDay Then If Form_frmPeopleClientsServiceDay.Inactive Then Call GreyAndNormal(IsClientDayLabel) Else Call BlueAndBold(IsClientDayLabel) Else Call YellowAndNormal(IsClientDayLabel)
    If IsClientVocat Then If Form_frmPeopleClientsServiceVocational.Inactive Then Call GreyAndNormal(IsClientVocatLabel) Else Call BlueAndBold(IsClientVocatLabel) Else Call YellowAndNormal(IsClientVocatLabel)
    If IsClientTrans Then If Form_frmPeopleClientsServiceTransportation.Inactive Then Call GreyAndNormal(IsClientTransLabel) Else Call BlueAndBold(IsClientTransLabel) Else Call YellowAndNormal(IsClientTransLabel)
    If IsClientDay Then If Form_frmPeopleClientsServiceDay.Inactive Then Call GreyAndNormal(IsClientDayLabel) Else Call BlueAndBold(IsClientDayLabel) Else Call YellowAndNormal(IsClientDayLabel)
    If IsClientPCA Then If Form_frmPeopleClientsServicePCA.Inactive Then Call GreyAndNormal(IsClientPCALabel) Else Call BlueAndBold(IsClientPCALabel) Else Call YellowAndNormal(IsClientPCALabel)
    If IsClientNHDay Then If Form_frmPeopleClientsServiceNHDay.Inactive Then Call GreyAndNormal(IsClientNHDayLabel) Else Call BlueAndBold(IsClientNHDayLabel) Else Call YellowAndNormal(IsClientNHDayLabel)
    If IsClientNHRes Then If Form_frmPeopleClientsServiceNHRes.Inactive Then Call GreyAndNormal(IsClientNHResLabel) Else Call BlueAndBold(IsClientNHResLabel) Else Call YellowAndNormal(IsClientNHResLabel)
    If IsClientCommunityConnections Then If Form_frmPeopleClientsServiceCommunityConnections.Inactive Then Call GreyAndNormal(IsClientCommunityConnectionsLabel) Else Call BlueAndBold(IsClientCommunityConnectionsLabel) Else Call YellowAndNormal(IsClientCommunityConnectionsLabel)
    If IsClientSpring Then If Form_frmPeopleClientsServiceSpringboard.Inactive Then Call GreyAndNormal(IsClientSpringLabel) Else Call BlueAndBold(IsClientSpringLabel) Else Call YellowAndNormal(IsClientSpringLabel)
    If IsClientTRASE Then If Form_frmPeopleClientsServiceTRASE.Inactive Then Call GreyAndNormal(IsClientTRASELabel) Else Call BlueAndBold(IsClientTRASELabel) Else Call YellowAndNormal(IsClientTRASELabel)
    Call CheckClientCompletelyInactive
End Sub

Private Sub SetNameProminence(NameType As String)
    Select Case NameType
        Case "Company"
            Me.Caption = CompanyOrganization: UpperCompany.Visible = True: LowerCompany.Visible = False: Title.Visible = False: IsDeceased.Visible = False
            DisplayName.Visible = False: IsClientLabel.Visible = False: IsClient.Visible = False: IsStaffLabel.Visible = False: IsStaff.Visible = False
            IsConsultantLabel.Visible = False: IsConsultant.Visible = False
        Case "Person"
            Me.Caption = FirstName & " " & MiddleInitial & " " & LastName: DisplayName.Visible = True: UpperCompany.Visible = False
            If Form_frmMainMenu.NewRecordInProgress Then LowerCompany.Visible = True Else LowerCompany.Visible = Not IsNull(CompanyOrganization)
            If IsNull(Title) Then Title.Visible = False Else Title.Visible = (Len(Title) > 0)
            IsClientLabel.Visible = True: IsClient.Visible = True: IsStaffLabel.Visible = True: IsStaff.Visible = True: IsConsultantLabel.Visible = True: IsConsultant.Visible = True
    End Select
    Salutation.Visible = False: FirstName.Visible = False: MiddleInitial.Visible = False: LastName.Visible = False
    If FamiliarGreeting = "Greetings" Then FamiliarGreeting.Visible = False Else FamiliarGreeting.Visible = True
End Sub

Private Sub DeceasedLock(Action As String)
    Select Case Action
        Case "Lock"
            IsDeceased.Enabled = False
            IsDeceased.Locked = True
        Case "Unlock"
            IsDeceased.Enabled = True
            IsDeceased.Locked = False
    End Select
End Sub

Private Sub SetLastViewedInfo()
    RecordLastViewedBy = Form_frmMainMenu.UserName
    RecordLastViewedDate = Format(Date, "mm/dd/yyyy")
End Sub

Private Function GetProgramClients(InnerJoinTable As Variant, IsClientService As Variant) As Long
    Dim SQLCommand As Variant
    
    DoCmd.SetWarnings False
    SQLCommand = "SELECT tblPeople.IndexedName INTO temptbl9 FROM tblPeople INNER JOIN " & InnerJoinTable & " ON tblPeople.IndexedName = " & InnerJoinTable & ".IndexedName " & _
        "WHERE tblPeople." & IsClientService & "=True AND tblPeople.IsDeceased=False AND " & InnerJoinTable & ".Inactive=False;"
    TILLDataBase.Execute SQLCommand, dbSeeChanges: Call BriefDelay
    GetProgramClients = DCount("IndexedName", "temptbl9")
    TILLDataBase.Execute "DROP TABLE temptbl9", dbSeeChanges: Call BriefDelay
    DoCmd.SetWarnings True
End Function

Private Function ActiveClientCount(Program As Variant) As Long
    ActiveClientCount = 0
    Select Case Program
        Case "Adult Coaching":              ActiveClientCount = GetProgramClients("tblPeopleClientsAdultCoaching", "IsClientAdultCoach")
        Case "Adult Companion":             ActiveClientCount = GetProgramClients("tblPeopleClientsAdultCompanion", "IsClientAdultComp")
        Case "AUTISM Support":              ActiveClientCount = GetProgramClients("tblPeopleClientsAutismServices", "IsClientAutism")
        Case "Creative Living Options":     ActiveClientCount = GetProgramClients("tblPeopleClientsCLOServices", "IsCilentCLO")
        Case "Day Programs":                ActiveClientCount = GetProgramClients("tblPeopleClientsDayServices", "IsClientDay")
        Case "Individual Support Services": ActiveClientCount = GetProgramClients("tblPeopleClientsIndividualSupportServices", "IsClientIndiv")
        Case "NH Day":                      ActiveClientCount = GetProgramClients("tblPeopleClientsNHDay", "IsClientNHDay")
        Case "NH Res":                      ActiveClientCount = GetProgramClients("tblPeopleClientsNHRes", "IsClientNHRes")
        Case "PCA":                         ActiveClientCount = GetProgramClients("tblPeopleClientsPCAServices", "IsClientPCA")
        Case "Recreation":                  ActiveClientCount = GetProgramClients("tblPeopleClientsCommunityConnectionsServices", "IsClientCommunityConnections")
        Case "Residential Services":        ActiveClientCount = GetProgramClients("tblPeopleClientsResidentialServices", "IsClientRes")
        Case "Shared Living":               ActiveClientCount = GetProgramClients("tblPeopleClientsSharedLivingServices", "IsClientSharedLiving")
        Case "SPRINGBOARD":                 ActiveClientCount = GetProgramClients("tblPeopleClientsSpringboardServices", "IsClientSpring")
        Case "Vocational Services":         ActiveClientCount = GetProgramClients("tblPeopleClientsVocationalServices", "IsClientVocat")
    End Select
End Function

Public Sub CopyAndDeleteClientFamilyRecord()
On Error GoTo ShowMeError
    ' Copy Family record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedFamilyByClientName"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleFamily WHERE tblPeopleFamily.ClientIndexedName =""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientFamilyRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientAdultCoachingRecord()
On Error GoTo ShowMeError
    ' Copy Adult Coaching record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedAdultCoaching"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsAdultCoaching WHERE tblPeopleClientsAdultCoaching.IndexedName= """ & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientAdultCoachingRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientAdultCompanionRecord()
On Error GoTo ShowMeError
    ' Copy Adult Companion record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedAdultCompanion"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsAdultCompanion WHERE tblPeopleClientsAdultCompanion.IndexedName= """ & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientAdultCompanionRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientAutismRecord()
On Error GoTo ShowMeError
    ' Copy Autism record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedAutism"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsAutismServices WHERE tblPeopleClientsAutismServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientAutismRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientCLORecord()
On Error GoTo ShowMeError
    ' Copy CLO record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedCLO"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsCLOServices WHERE tblPeopleClientsCLOServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientCLORecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientCommunityConnectionsRecord()
On Error GoTo ShowMeError
    ' Copy Community Connections record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedCommunityConnections"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsCommunityConnectionsServices " & _
        "WHERE tblPeopleClientsCommunityConnectionsServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientCommunityConnectionsRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientDayServicesRecord()
On Error GoTo ShowMeError
    ' Copy Day record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedDay"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsDayServices " & _
        "WHERE tblPeopleClientsDayServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientDayServicesRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientISSRecord()
On Error GoTo ShowMeError
    ' Copy Individual Support record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedISS"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsIndividualSupportServices " & _
        "WHERE tblPeopleClientsIndividualSupportServices.IndexedName= """ & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientISSRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientNHDayRecord()
On Error GoTo ShowMeError
    ' Copy NHDay record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedNHDay"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsNHDay " & _
        "WHERE tblPeopleClientsNHDay.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientNHDayRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientNHResRecord()
On Error GoTo ShowMeError
    ' Copy NHRes record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedNHRes"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsNHRes " & _
        "WHERE tblPeopleClientsNHRes.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientNHResRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientPCARecord()
On Error GoTo ShowMeError
    ' Copy PCA record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedPCA"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsPCAServices " & _
        "WHERE tblPeopleClientsPCAServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    ' Copy PCA Contact Notes record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedPCAContactNotes"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsPCAServicesContactNotes " & _
        "WHERE tblPeopleClientsPCAServicesContactNotes.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientPCARecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientResidentialRecord()
On Error GoTo ShowMeError
    ' Copy Residential record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedResidential"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsResidentialServices " & _
        "WHERE tblPeopleClientsResidentialServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientResidentialRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientSharedLivingRecord()
On Error GoTo ShowMeError
    ' Copy Shared Living record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedSharedLiving"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsSharedLivingServices " & _
        "WHERE tblPeopleClientsSharedLivingServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientSharedLivingRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientSpringboardRecord()
On Error GoTo ShowMeError
    ' Copy Springboard record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedSpringboard"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsSpringboardServices " & _
        "WHERE tblPeopleClientsSpringboardServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientSpringboardRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientTransportationRecord()
On Error GoTo ShowMeError
    ' Copy Transportation record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedTransportation"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsTransportationServices " & _
        "WHERE tblPeopleClientsTransportationServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientTransportationRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientTRASERecord()
On Error GoTo ShowMeError
    ' Copy TRASE record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedTRASE"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsTRASEServices " & _
        "WHERE tblPeopleClientsTRASEServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    DoCmd.SetWarnings True
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientTRASERecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientVocationalRecord()
On Error GoTo ShowMeError
    ' Copy Vocational record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedVocational"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsVocationalServices " & _
        "WHERE tblPeopleClientsVocationalServices.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientVocationalRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientDemographicsRecord()
On Error GoTo ShowMeError
    ' Copy Demographics record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedClientDemographics"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsDemographics " & _
        "WHERE tblPeopleClientsDemographics.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientDemographicsRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteClientVendorsRecord()
On Error GoTo ShowMeError
    ' Copy Vendor record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedClientVendors"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleClientsVendors " & _
        "WHERE tblPeopleClientsVendors.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteClientVendorsRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteConsultantRecord()
On Error GoTo ShowMeError
    ' Deleted Consultant records here.
    TILLDataBase.Execute "DELETE * FROM tblPeopleConsultants WHERE tblPeopleConsultants.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Call UpdateChangeLog("CONSULTANT RECORD(S) DELETED", "")
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteConsultantRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteDonorRecord()
On Error GoTo ShowMeError
    ' Copy Donor record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedDonors"
    Call BriefDelay
    DoCmd.SetWarnings True
    ' Deleted Donor records here.
    TILLDataBase.Execute "DELETE * FROM tblPeopleDonors WHERE tblPeopleDonors.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Call UpdateChangeLog("DONOR RECORD(S) DELETED", "")
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteDonorRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeleteFamilyRecord()
On Error GoTo ShowMeError
    ' Copy Family record(s) to the DELETED table then delete them from the primary table.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryCopyDeletedFamilyByFamilyName"
    Call BriefDelay
    DoCmd.SetWarnings True
    TILLDataBase.Execute "DELETE * FROM tblPeopleFamily " & _
        "WHERE tblPeopleFamily.IndexedName=""" & Form_frmPeople.IndexedName & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    Call UpdateChangeLog("FAMILY RECORD(S) DELETED", "")
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeleteFamilyRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

Public Sub CopyAndDeletePeopleRecord(RememberIndexedName As String)
On Error GoTo ShowMeError
    ' Copy the main people record to the Deleted table in case we need to recover it.
    DoCmd.SetWarnings False
    DoCmd.OpenQuery "qryAppendDeletedPerson"
    Call BriefDelay
    ' Delete the main people record.
    TILLDataBase.Execute "DELETE tblPeople.* FROM tblPeople WHERE tblPeople.IndexedName=""" & [Forms]![frmMainMenu]![RememberIndexedName] & """;", dbSeeChanges: Call BriefDelay
    Call BriefDelay
    DoCmd.SetWarnings False
    Call UpdateChangeLog("PEOPLE RECORD DELETED", "")
    Exit Sub
ShowMeError:
    DoCmd.SetWarnings True
    MsgBox "Error # " & Str(Err.Number) & " was generated by CopyAndDeletePeopleRecord.  " & Chr(13) & Err.Description, vbOKOnly, "Error", Err.HelpFile, Err.HelpContext
End Sub

